---
output:
  word_document: default
---

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(here)
library(gridExtra)
```

# Occurrence Periods

Occurrence records were divided into 10 year periods to facilitate assessment of *temporal* variations in the levels of biases over time.

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
## AUS GLONAF
directory_files_aus_glonaf = list.files(here("13.  bias assessment results", "aus_glonaf_invaded_clean"))
file_link_aus_glonaf = here("13.  bias assessment results", "aus_glonaf_invaded_clean", directory_files_aus_glonaf[grepl("periods_output", directory_files_aus_glonaf)])
periods_aus_glonaf = read.csv(file = file_link_aus_glonaf)

periods_range_aus_glonaf = data.frame(Period = 1:ncol(periods_aus_glonaf))
for (i in 1:ncol(periods_aus_glonaf)) {
  periods_range_aus_glonaf$range_years[i] = paste(min(periods_aus_glonaf[, i], na.rm = T), 
                                  max(periods_aus_glonaf[ , i], na.rm = T), sep = "-")
}
periods_range_aus_glonaf$range_years = as.factor(periods_range_aus_glonaf$range_years)

## GBR
directory_files_gbr = list.files(here("13.  bias assessment results", "gbr_invaded_clean"))
file_link_gbr = here("13.  bias assessment results", "gbr_invaded_clean", directory_files_gbr[grepl("periods_output", directory_files_gbr)])
periods_gbr = read.csv(file = file_link_gbr)

periods_range_gbr = data.frame(Period = 1:ncol(periods_gbr))
for (i in 1:ncol(periods_gbr)) {
  periods_range_gbr$range_years[i] = paste(min(periods_gbr[, i], na.rm = T), 
                                  max(periods_gbr[ , i], na.rm = T), sep = "-")
}
periods_range_gbr$range_years = as.factor(periods_range_gbr$range_years)

## IRL
directory_files_irl = list.files(here("13.  bias assessment results", "irl_invaded_clean"))
file_link_irl = here("13.  bias assessment results", "irl_invaded_clean", directory_files_irl[grepl("periods_output", directory_files_irl)])
periods_irl = read.csv(file = file_link_irl)

periods_range_irl = data.frame(Period = 1:ncol(periods_irl))
for (i in 1:ncol(periods_irl)) {
  periods_range_irl$range_years[i] = paste(min(periods_irl[, i], na.rm = T), 
                                  max(periods_irl[ , i], na.rm = T), sep = "-")
}
periods_range_irl$range_years = as.factor(periods_range_irl$range_years)

## JPN
directory_files_jpn = list.files(here("13.  bias assessment results", "jpn_invaded_clean"))
file_link_jpn = here("13.  bias assessment results", "jpn_invaded_clean", directory_files_jpn[grepl("periods_output", directory_files_jpn)])
periods_jpn = read.csv(file = file_link_jpn)

periods_range_jpn = data.frame(Period = 1:ncol(periods_jpn))
for (i in 1:ncol(periods_jpn)) {
  periods_range_jpn$range_years[i] = paste(min(periods_jpn[, i], na.rm = T), 
                                  max(periods_jpn[ , i], na.rm = T), sep = "-")
}
periods_range_jpn$range_years = as.factor(periods_range_jpn$range_years)

## MDG
directory_files_mdg = list.files(here("13.  bias assessment results", "mdg_invaded_clean"))
file_link_mdg = here("13.  bias assessment results", "mdg_invaded_clean", directory_files_mdg[grepl("periods_output", directory_files_mdg)])
periods_mdg = read.csv(file = file_link_mdg)

periods_range_mdg = data.frame(Period = 1:ncol(periods_mdg))
for (i in 1:ncol(periods_mdg)) {
  periods_range_mdg$range_years[i] = paste(min(periods_mdg[, i], na.rm = T), 
                                  max(periods_mdg[ , i], na.rm = T), sep = "-")
}
periods_range_mdg$range_years = as.factor(periods_range_mdg$range_years)

## NZL GLONAF
directory_files_nzl_glonaf = list.files(here("13.  bias assessment results", "nzl_glonaf_invaded_clean"))
file_link_nzl_glonaf = here("13.  bias assessment results", "nzl_glonaf_invaded_clean", directory_files_nzl_glonaf[grepl("periods_output", directory_files_nzl_glonaf)])
periods_nzl_glonaf = read.csv(file = file_link_nzl_glonaf)

periods_range_nzl_glonaf = data.frame(Period = 1:ncol(periods_nzl_glonaf))
for (i in 1:ncol(periods_nzl_glonaf)) {
  periods_range_nzl_glonaf$range_years[i] = paste(min(periods_nzl_glonaf[, i], na.rm = T), 
                                  max(periods_nzl_glonaf[ , i], na.rm = T), sep = "-")
}
periods_range_nzl_glonaf$range_years = as.factor(periods_range_nzl_glonaf$range_years)

## USA
directory_files_usa = list.files(here("13.  bias assessment results", "usa_invaded_clean"))
file_link_usa = here("13.  bias assessment results", "usa_invaded_clean", directory_files_usa[grepl("periods_output", directory_files_usa)])
periods_usa = read.csv(file = file_link_usa)

periods_range_usa = data.frame(Period = 1:ncol(periods_usa))
for (i in 1:ncol(periods_usa)) {
  periods_range_usa$range_years[i] = paste(min(periods_usa[, i], na.rm = T), 
                                  max(periods_usa[ , i], na.rm = T), sep = "-")
}
periods_range_usa$range_years = as.factor(periods_range_usa$range_years)

## ZAF
directory_files_zaf = list.files(here("13.  bias assessment results", "zaf_invaded_clean"))
file_link_zaf = here("13.  bias assessment results", "zaf_invaded_clean", directory_files_zaf[grepl("periods_output", directory_files_zaf)])
periods_zaf = read.csv(file = file_link_zaf)

periods_range_zaf = data.frame(Period = 1:ncol(periods_zaf))
for (i in 1:ncol(periods_zaf)) {
  periods_range_zaf$range_years[i] = paste(min(periods_zaf[, i], na.rm = T), 
                                  max(periods_zaf[ , i], na.rm = T), sep = "-")
}
periods_range_zaf$range_years = as.factor(periods_range_zaf$range_years)
```

The table below summarizes the periods covered in each of the assessed occurrence datasets

Table 1: Periods assessed 
```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
## Summary of occurrence periods
Occurrence_summary = rbind(
  c("aus_glonaf", min(periods_aus_glonaf), max(periods_aus_glonaf), ncol(periods_aus_glonaf)),
  c("gbr", min(periods_gbr), max(periods_gbr), ncol(periods_gbr)),
  c("irl", min(periods_irl), max(periods_irl), ncol(periods_irl)),
  c("jpn", min(periods_jpn), max(periods_jpn), ncol(periods_jpn)),
  c("mdg", min(periods_mdg), max(periods_mdg), ncol(periods_mdg)),
  c("nzl_glonaf", min(periods_nzl_glonaf), max(periods_nzl_glonaf), ncol(periods_nzl_glonaf)),
  c("usa", min(periods_usa), max(periods_usa), ncol(periods_usa)),
  c("zaf", min(periods_zaf), max(periods_zaf), ncol(periods_zaf))) |> 
  data.frame()

names(Occurrence_summary) = c("Range", "start", "end", "number of periods")

Occurrence_summary = Occurrence_summary |> 
  dplyr::mutate(start = as.numeric(start), 
                end = as.numeric(end),
                `number of periods` = as.numeric(`number of periods`)) |> 
  dplyr::arrange(start) 

Occurrence_summary |>
  knitr::kable()
```

Occurrence records on the invaded ranges assessed cover *3 centuries* with the earliest records taken in the *USA* and *GBR* in the *17th century* (*1601* and *1631* respectively) while *IRL*, *MDG* and *JPN* had the most recent earliest record captured in the *19th* century (*1801*, *1821* and *1861* respectively). 

We use ANOVA and the Tukey multiple comparison tests to test for variations in the levels of bias between the different *periods* (temporal bias), between *occurrence ranges*, and between the different *taxonomic groups* (*species* and *families*) which form the basis of our bias comparisons. 

# 1. Sampling intensity biases

We use the following measures to assess Sampling intensity bias:

- differences in the number of observations identified between taxonomic groups
- changes in the number of observations identified over time (temporal Sampling intensity bias)


## (a) Number of observations identified

### (i) by taxonomic group 

**(Family)**

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(dplyr)
## AUS GLONAF
file_link_aus_glonaf = here("13.  bias assessment results", "aus_glonaf_invaded_clean", directory_files_aus_glonaf[grepl("assessRecordNumber_output", directory_files_aus_glonaf)])

file_link_aus_glonaf = file_link_aus_glonaf[!grepl("species", file_link_aus_glonaf)]
assessRecordNumber_aus_glonaf = read.csv(file = file_link_aus_glonaf) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 
  
assessRecordNumber_aus_glonaf = assessRecordNumber_aus_glonaf |> 
  merge(periods_range_aus_glonaf, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group) 

## GBR
file_link_gbr = here("13.  bias assessment results", "gbr_invaded_clean", directory_files_gbr[grepl("assessRecordNumber_output", directory_files_gbr)])

file_link_gbr = file_link_gbr[!grepl("species", file_link_gbr)]
assessRecordNumber_gbr = read.csv(file = file_link_gbr) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_gbr = assessRecordNumber_gbr |> 
  merge(periods_range_gbr, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## IRL
file_link_irl = here("13.  bias assessment results", "irl_invaded_clean", directory_files_irl[grepl("assessRecordNumber_output", directory_files_irl)])

file_link_irl = file_link_irl[!grepl("species", file_link_irl)]
assessRecordNumber_irl = read.csv(file = file_link_irl) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_irl = assessRecordNumber_irl |> 
  merge(periods_range_irl, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## JPN
file_link_jpn = here("13.  bias assessment results", "jpn_invaded_clean", directory_files_jpn[grepl("assessRecordNumber_output", directory_files_jpn)])

file_link_jpn = file_link_jpn[!grepl("species", file_link_jpn)]
assessRecordNumber_jpn = read.csv(file = file_link_jpn) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_jpn = assessRecordNumber_jpn |> 
  merge(periods_range_jpn, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## MDG
file_link_mdg = here("13.  bias assessment results", "mdg_invaded_clean", directory_files_mdg[grepl("assessRecordNumber_output", directory_files_mdg)])

file_link_mdg = file_link_mdg[!grepl("species", file_link_mdg)]
assessRecordNumber_mdg = read.csv(file = file_link_mdg) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_mdg = assessRecordNumber_mdg |> 
  merge(periods_range_mdg, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## NZL GLONAF
file_link_nzl_glonaf = here("13.  bias assessment results", "nzl_glonaf_invaded_clean", directory_files_nzl_glonaf[grepl("assessRecordNumber_output", directory_files_nzl_glonaf)])

file_link_nzl_glonaf = file_link_nzl_glonaf[!grepl("species", file_link_nzl_glonaf)]
assessRecordNumber_nzl_glonaf = read.csv(file = file_link_nzl_glonaf) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_nzl_glonaf = assessRecordNumber_nzl_glonaf |> 
  merge(periods_range_nzl_glonaf, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## USA
file_link_usa = here("13.  bias assessment results", "usa_invaded_clean", directory_files_usa[grepl("assessRecordNumber_output", directory_files_usa)])

file_link_usa = file_link_usa[!grepl("species", file_link_usa)]
assessRecordNumber_usa = read.csv(file = file_link_usa) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_usa = assessRecordNumber_usa |> 
  merge(periods_range_usa, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## ZAF
file_link_zaf = here("13.  bias assessment results", "zaf_invaded_clean", directory_files_zaf[grepl("assessRecordNumber_output", directory_files_zaf)])

file_link_zaf = file_link_zaf[!grepl("species", file_link_zaf)]
assessRecordNumber_zaf = read.csv(file = file_link_zaf) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_zaf = assessRecordNumber_zaf |> 
  merge(periods_range_zaf, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)
```

The set of figures below (Figure 1) visualize the cumulative number of observations recorded for different *families* over the occurrence periods in the respective occurrence ranges. 

Figure 1: Number of recorded *observations per family* over time
```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(ggplot2)

## AUS GLONAF
record_number_aus_glonaf = assessRecordNumber_aus_glonaf |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "AUS GLONAF - Sampling Intensity \n  (Number of records) by  Family") +
  theme(legend.position = "none")

## GBR
record_number_gbr = assessRecordNumber_gbr |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "GBR - Sampling Intensity \n  (Number of records) by  Family") +
  theme(legend.position = "none")

## IRL
record_number_irl = assessRecordNumber_irl |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "IRL - Sampling Intensity \n  (Number of records) by  Family") +
  theme(legend.position = "none")

## JPN
record_number_jpn = assessRecordNumber_jpn |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "JPN - Sampling Intensity \n  (Number of records) by  Family") +
  theme(legend.position = "none")

## MDG
record_number_mdg = assessRecordNumber_mdg |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "MDG - Sampling Intensity \n  (Number of records) by  Family") +
  theme(legend.position = "none")

## NZL GLONAF
record_number_nzl_glonaf = assessRecordNumber_nzl_glonaf |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "NZL GLONAF - Sampling Intensity \n  (Number of records) by  Family") +
  theme(legend.position = "none")

## USA
record_number_usa = assessRecordNumber_usa |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "USA - Sampling Intensity \n  (Number of records) by  Family") +
  theme(legend.position = "none")

## ZAF
record_number_zaf = assessRecordNumber_zaf |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "ZAF - Sampling Intensity \n  (Number of records) by  Family") +
  theme(legend.position = "none")


grid.arrange(record_number_aus_glonaf, record_number_gbr, ncol = 2)
grid.arrange(record_number_irl, record_number_jpn, ncol = 2)
grid.arrange(record_number_mdg, record_number_nzl_glonaf, ncol = 2)
grid.arrange(record_number_usa, record_number_zaf, ncol = 2)
```


**(Species)**
  
```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(dplyr)

## AUS GLONAF
file_link_aus_glonaf_by_species = here("13.  bias assessment results", "aus_glonaf_invaded_clean", directory_files_aus_glonaf[grepl("assessRecordNumber_output", directory_files_aus_glonaf)])

file_link_aus_glonaf_by_species = file_link_aus_glonaf_by_species[grepl("species", file_link_aus_glonaf_by_species)]
assessRecordNumber_aus_glonaf_by_species = read.csv(file = file_link_aus_glonaf_by_species) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_aus_glonaf_by_species = assessRecordNumber_aus_glonaf_by_species |> 
  merge(periods_range_aus_glonaf, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## GBR
file_link_gbr_by_species = here("13.  bias assessment results", "gbr_invaded_clean", directory_files_gbr[grepl("assessRecordNumber_output", directory_files_gbr)])

file_link_gbr_by_species = file_link_gbr_by_species[grepl("species", file_link_gbr_by_species)]
assessRecordNumber_gbr_by_species = read.csv(file = file_link_gbr_by_species) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_gbr_by_species = assessRecordNumber_gbr_by_species |> 
  merge(periods_range_gbr, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## IRL
file_link_irl_by_species = here("13.  bias assessment results", "irl_invaded_clean", directory_files_irl[grepl("assessRecordNumber_output", directory_files_irl)])

file_link_irl_by_species = file_link_irl_by_species[grepl("species", file_link_irl_by_species)]
assessRecordNumber_irl_by_species = read.csv(file = file_link_irl_by_species) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_irl_by_species = assessRecordNumber_irl_by_species |> 
  merge(periods_range_irl, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## JPN
file_link_jpn_by_species = here("13.  bias assessment results", "jpn_invaded_clean", directory_files_jpn[grepl("assessRecordNumber_output", directory_files_jpn)])

file_link_jpn_by_species = file_link_jpn_by_species[grepl("species", file_link_jpn_by_species)]
assessRecordNumber_jpn_by_species = read.csv(file = file_link_jpn_by_species) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_jpn_by_species = assessRecordNumber_jpn_by_species |> 
  merge(periods_range_jpn, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## MDG
file_link_mdg_by_species = here("13.  bias assessment results", "mdg_invaded_clean", directory_files_mdg[grepl("assessRecordNumber_output", directory_files_mdg)])

file_link_mdg_by_species = file_link_mdg_by_species[grepl("species", file_link_mdg_by_species)]
assessRecordNumber_mdg_by_species = read.csv(file = file_link_mdg_by_species) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_mdg_by_species = assessRecordNumber_mdg_by_species |> 
  merge(periods_range_mdg, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## NZL GLONAF
file_link_nzl_glonaf_by_species = here("13.  bias assessment results", "nzl_glonaf_invaded_clean", directory_files_nzl_glonaf[grepl("assessRecordNumber_output", directory_files_nzl_glonaf)])

file_link_nzl_glonaf_by_species = file_link_nzl_glonaf_by_species[grepl("species", file_link_nzl_glonaf_by_species)]
assessRecordNumber_nzl_glonaf_by_species = read.csv(file = file_link_nzl_glonaf_by_species) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_nzl_glonaf_by_species = assessRecordNumber_nzl_glonaf_by_species |> 
  merge(periods_range_nzl_glonaf, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## USA
file_link_usa_by_species = here("13.  bias assessment results", "usa_invaded_clean", directory_files_usa[grepl("assessRecordNumber_output", directory_files_usa)])

file_link_usa_by_species = file_link_usa_by_species[grepl("species", file_link_usa_by_species)]
assessRecordNumber_usa_by_species = read.csv(file = file_link_usa_by_species) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_usa_by_species = assessRecordNumber_usa_by_species |> 
  merge(periods_range_usa, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## ZAF
file_link_zaf_by_species = here("13.  bias assessment results", "zaf_invaded_clean", directory_files_zaf[grepl("assessRecordNumber_output", directory_files_zaf)])

file_link_zaf_by_species = file_link_zaf_by_species[grepl("species", file_link_zaf_by_species)]
assessRecordNumber_zaf_by_species = read.csv(file = file_link_zaf_by_species) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessRecordNumber_zaf_by_species = assessRecordNumber_zaf_by_species |> 
  merge(periods_range_zaf, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)
```


Similarly, the set of figures below (Figure 2) visualize the cummulative Number of records recorded for different *species* over the occurrence periods in the respective regions. 

Figure 2: Sampling Intensity (Number of records) for occurrence data (Invaded Ranges)
```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, fig.show='asis'}
library(ggplot2)
n_species_aus_glonaf = assessRecordNumber_aus_glonaf_by_species |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "Sampling Intensity \n (Number of records) by  Species: \n AUS GLONAF") +
  theme(legend.position = "none")


n_species_gbr = assessRecordNumber_gbr_by_species |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "Sampling Intensity \n (Number of records) by  Species: \n GBR") +
  theme(legend.position = "none")


n_species_irl = assessRecordNumber_irl_by_species |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "Sampling Intensity \n (Number of records) by  Species: \n IRL") +
  theme(legend.position = "none")


n_species_jpn = assessRecordNumber_jpn_by_species |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "Sampling Intensity \n (Number of records) by  Species: \n JPN") +
  theme(legend.position = "none")


n_species_mdg = assessRecordNumber_mdg_by_species |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "Sampling Intensity \n (Number of records) by  Species: \n MDG") +
  theme(legend.position = "none")


n_species_nzl_glonaf = assessRecordNumber_nzl_glonaf_by_species |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "Sampling Intensity \n (Number of records) by  Species: \n NZL GLONAF") +
  theme(legend.position = "none")


n_species_usa = assessRecordNumber_usa_by_species |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "Sampling Intensity \n (Number of records) by  Species: \n USA") +
  theme(legend.position = "none")


n_species_zaf = assessRecordNumber_zaf_by_species |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = "Sampling Intensity \n (Number of records) by  Species: \n ZAF") +
  theme(legend.position = "none")


grid.arrange(n_species_aus_glonaf, n_species_gbr, ncol = 2)
grid.arrange(n_species_irl, n_species_jpn, ncol = 2)
grid.arrange(n_species_mdg, n_species_nzl_glonaf, ncol = 2)
grid.arrange(n_species_usa, n_species_zaf, ncol = 2)
```

We observe:

(a) An apparent difference in the Number of records identified across taxonomic groups (families). We use the *Analysis of Variance (ANOVA)* to test whether the observed differences in the Number of records identified between families are significant. The *Tukey multiple comparison test* helps us compare pairs of taxonomic groups and identify those with significantly more samples (*presence of taxonomic bias*).

(b) A general increase in the Number of records identified across the periods. We estimate the *slopes* of the per-period Number of records observations for the different families and identify the families with *slopes significantly different from 0*, which imply a change in the Number of records observations over time (*presence of temporal change in taxonomic bias*) 

(c) When the Number of records are assessed at *species* level, there is *no more than 1* observation made per species in a 10 year period. Therefore, there appears to be no temporal change in the Number of records identified between the periods.



```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
# **(Family)**

# AUS GLONAF
fit_records_aus_glonaf = aov(val ~ Taxonomic_Group , data = assessRecordNumber_aus_glonaf_by_species)
summary_fit_records_aus_glonaf = fit_records_aus_glonaf |> summary()
p.value_aus_glonaf = (summary_fit_records_aus_glonaf |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_aus_glonaf = TukeyHSD(fit_records_aus_glonaf, "Taxonomic_Group")

x = table(assessRecordNumber_aus_glonaf_by_species$Taxonomic_Group)
species_differences_aus_glonaf2 = tukey_species_aus_glonaf$Taxonomic_Group |> as.data.frame() 
for (i in length(x):1) {
    species_differences_aus_glonaf2[grepl(x = species_differences_aus_glonaf2 |> row.names(), pattern = names(x)[i]), "count"] = paste(species_differences_aus_glonaf2[grepl(x = species_differences_aus_glonaf2 |> row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_aus_glonaf2$count = gsub("NA, ", "", species_differences_aus_glonaf2$count)

species_differences_aus_glonaf = tukey_species_aus_glonaf$Taxonomic_Group[!(tukey_species_aus_glonaf$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_aus_glonaf = cbind(data.frame(do.call(rbind, (rownames(species_differences_aus_glonaf) |> strsplit(split = "-")))),
      species_differences_aus_glonaf)

## groups with bias
biased_groups_aus_glonaf = rownames(species_differences_aus_glonaf) |> strsplit(split = "-") |>
  unlist()


# GBR
fit_records_gbr = aov(val ~ Taxonomic_Group , data = assessRecordNumber_gbr_by_species)
summary_fit_records_gbr = fit_records_gbr |> summary()
p.value_gbr = (summary_fit_records_gbr |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_gbr = TukeyHSD(fit_records_gbr, "Taxonomic_Group")

x = table(assessRecordNumber_gbr_by_species$Taxonomic_Group) 
species_differences_gbr2 = tukey_species_gbr$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_gbr2[grepl(x = species_differences_gbr2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_gbr2[grepl(x = species_differences_gbr2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_gbr2$count = gsub("NA, ", "", species_differences_gbr2$count)

species_differences_gbr = tukey_species_gbr$Taxonomic_Group[!(tukey_species_gbr$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_gbr = cbind(data.frame(do.call(rbind, (rownames(species_differences_gbr) |> strsplit(split = "-")))),
      species_differences_gbr)

## groups with bias
biased_groups_gbr = rownames(species_differences_gbr) |> strsplit(split = "-") |>
  unlist()


# IRL
fit_records_irl = aov(val ~ Taxonomic_Group , data = assessRecordNumber_irl_by_species)
summary_fit_records_irl = fit_records_irl |> summary()
p.value_irl = (summary_fit_records_irl |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_irl = TukeyHSD(fit_records_irl, "Taxonomic_Group")

x = table(assessRecordNumber_irl_by_species$Taxonomic_Group) 
species_differences_irl2 = tukey_species_irl$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_irl2[grepl(x = species_differences_irl2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_irl2[grepl(x = species_differences_irl2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_irl2$count = gsub("NA, ", "", species_differences_irl2$count)

species_differences_irl = tukey_species_irl$Taxonomic_Group[!(tukey_species_irl$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_irl = cbind(data.frame(do.call(rbind, (rownames(species_differences_irl) |> strsplit(split = "-")))),
      species_differences_irl)

## groups with bias
biased_groups_irl = rownames(species_differences_irl) |> strsplit(split = "-") |>
  unlist()


# JPN
fit_records_jpn = aov(val ~ Taxonomic_Group , data = assessRecordNumber_jpn_by_species)
summary_fit_records_jpn = fit_records_jpn |> summary()
p.value_jpn = (summary_fit_records_jpn |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_jpn = TukeyHSD(fit_records_jpn, "Taxonomic_Group")

x = table(assessRecordNumber_jpn_by_species$Taxonomic_Group) 
species_differences_jpn2 = tukey_species_jpn$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_jpn2[grepl(x = species_differences_jpn2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_jpn2[grepl(x = species_differences_jpn2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_jpn2$count = gsub("NA, ", "", species_differences_jpn2$count)

species_differences_jpn = tukey_species_jpn$Taxonomic_Group[!(tukey_species_jpn$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_jpn = cbind(data.frame(do.call(rbind, (rownames(species_differences_jpn) |> strsplit(split = "-")))),
      species_differences_jpn)

## groups with bias
biased_groups_jpn = rownames(species_differences_jpn) |> strsplit(split = "-") |>
  unlist()


# MDG
fit_records_mdg = aov(val ~ Taxonomic_Group , data = assessRecordNumber_mdg_by_species)
summary_fit_records_mdg = fit_records_mdg |> summary()
p.value_mdg = (summary_fit_records_mdg |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_mdg = TukeyHSD(fit_records_mdg, "Taxonomic_Group")

x = table(assessRecordNumber_mdg_by_species$Taxonomic_Group) 
species_differences_mdg2 = tukey_species_mdg$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_mdg2[grepl(x = species_differences_mdg2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_mdg2[grepl(x = species_differences_mdg2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_mdg2$count = gsub("NA, ", "", species_differences_mdg2$count)

species_differences_mdg = tukey_species_mdg$Taxonomic_Group[!(tukey_species_mdg$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_mdg = cbind(data.frame(do.call(rbind, (rownames(species_differences_mdg) |> strsplit(split = "-")))),
      species_differences_mdg)

## groups with bias
biased_groups_mdg = rownames(species_differences_mdg) |> strsplit(split = "-") |>
  unlist()


# NZL GLONAF
fit_records_nzl_glonaf = aov(val ~ Taxonomic_Group , data = assessRecordNumber_nzl_glonaf_by_species)
summary_fit_records_nzl_glonaf = fit_records_nzl_glonaf |> summary()
p.value_nzl_glonaf = (summary_fit_records_nzl_glonaf |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_nzl_glonaf = TukeyHSD(fit_records_nzl_glonaf, "Taxonomic_Group")

x = table(assessRecordNumber_nzl_glonaf_by_species$Taxonomic_Group) 
species_differences_nzl_glonaf2 = tukey_species_nzl_glonaf$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_nzl_glonaf2[grepl(x = species_differences_nzl_glonaf2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_nzl_glonaf2[grepl(x = species_differences_nzl_glonaf2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_nzl_glonaf2$count = gsub("NA, ", "", species_differences_nzl_glonaf2$count)

species_differences_nzl_glonaf = tukey_species_nzl_glonaf$Taxonomic_Group[!(tukey_species_nzl_glonaf$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_nzl_glonaf = cbind(data.frame(do.call(rbind, (rownames(species_differences_nzl_glonaf) |> strsplit(split = "-")))),
      species_differences_nzl_glonaf)

## groups with bias
biased_groups_nzl_glonaf = rownames(species_differences_nzl_glonaf) |> strsplit(split = "-") |>
  unlist()


# USA
fit_records_usa = aov(val ~ Taxonomic_Group , data = assessRecordNumber_usa_by_species)
summary_fit_records_usa = fit_records_usa |> summary()
p.value_usa = (summary_fit_records_usa |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_usa = TukeyHSD(fit_records_usa, "Taxonomic_Group")

x = table(assessRecordNumber_usa_by_species$Taxonomic_Group) 
species_differences_usa2 = tukey_species_usa$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_usa2[grepl(x = species_differences_usa2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_usa2[grepl(x = species_differences_usa2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_usa2$count = gsub("NA, ", "", species_differences_usa2$count)

species_differences_usa = tukey_species_usa$Taxonomic_Group[!(tukey_species_usa$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_usa = cbind(data.frame(do.call(rbind, (rownames(species_differences_usa) |> strsplit(split = "-")))),
      species_differences_usa)

## groups with bias
biased_groups_usa = rownames(species_differences_usa) |> strsplit(split = "-") |>
  unlist()


# ZAF
fit_records_zaf = aov(val ~ Taxonomic_Group , data = assessRecordNumber_zaf_by_species)
summary_fit_records_zaf = fit_records_zaf |> summary()
p.value_zaf = (summary_fit_records_zaf |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_zaf = TukeyHSD(fit_records_zaf, "Taxonomic_Group")

x = table(assessRecordNumber_zaf_by_species$Taxonomic_Group) 
species_differences_zaf2 = tukey_species_zaf$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_zaf2[grepl(x = species_differences_zaf2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_zaf2[grepl(x = species_differences_zaf2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_zaf2$count = gsub("NA, ", "", species_differences_zaf2$count)

species_differences_zaf = tukey_species_zaf$Taxonomic_Group[!(tukey_species_zaf$Taxonomic_Group[, "p adj"] > 0.05) , ] |> 
  t() |> as.data.frame() |>
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_zaf = cbind(data.frame(do.call(rbind, (rownames(species_differences_zaf) |> strsplit(split = "-")))),
      species_differences_zaf)

## groups with bias
biased_groups_zaf = rownames(species_differences_zaf) |> strsplit(split = "-") |>
  unlist()
```



Table 3 below gives the p-value of the *ANOVA* tests for the different occurrence ranges. The *P-values < 0.05* imply presence of a significant variation in the Number of records identified between some of the families in the datasets. 

Table 3: ANOVA p-values - Differences in the Number of records across taxonomic groups (families)
```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
## **(species)**

dplyr::tibble(
  range = c("AUS GLONAF", "GBR", "IRL", "JPN", "MDG", "NZL GLONAF", "USA", "ZAF"),
  
  `number of families` = c(
    assessRecordNumber_aus_glonaf_by_species$Taxonomic_Group |> unique() |> length() ,
    assessRecordNumber_gbr_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_irl_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_jpn_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_mdg_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_nzl_glonaf_by_species$Taxonomic_Group |> unique() |> length() ,
    assessRecordNumber_usa_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_zaf_by_species$Taxonomic_Group |> unique() |> length()),
  
  `pairs of families compared` = c(
    assessRecordNumber_aus_glonaf_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_gbr_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_irl_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_jpn_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_mdg_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_nzl_glonaf_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_usa_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_zaf_by_species$Taxonomic_Group |> unique() |> length() |> choose(2)),
  
  `pairs of families with bias` = c(
    species_differences_aus_glonaf |> nrow(),
    species_differences_gbr |> nrow(),
    species_differences_irl |> nrow(),
    species_differences_jpn |> nrow(),
    species_differences_mdg |> nrow(),
    species_differences_nzl_glonaf |> nrow(),
    species_differences_usa |> nrow(),
    species_differences_zaf |> nrow()),
  
  `number of families with bias` = c(
    biased_groups_aus_glonaf |> unique() |> length(),
    biased_groups_gbr |> unique() |> length(),
    biased_groups_irl |> unique() |> length(),
    biased_groups_jpn |> unique() |> length(),
    biased_groups_mdg |> unique() |> length(),
    biased_groups_nzl_glonaf |> unique() |> length(),
    biased_groups_usa |> unique() |> length(),
    biased_groups_zaf |> unique() |> length()),
  
  `% of families with bias` = round(100 * `number of families with bias` / `number of families`, 2),
  
  `% of family pairs with bias` = round(100 * `pairs of families with bias` / `pairs of families compared`, 2),
  
  `ANOVA p.value` = c(p.value_aus_glonaf, p.value_gbr, p.value_irl, p.value_jpn, p.value_mdg, p.value_nzl_glonaf, p.value_usa, p.value_zaf)) |> 
  dplyr::mutate(`ANOVA p.value` = round(`ANOVA p.value`, 4)) |>
  knitr::kable()
```


Note that although *all families (100% of families assessed)* had some level of taxonomic bias relative to atleast *1 other family* except in *IRL* where only $40\%$ of the families with bias, there is a high level of homogeneity in sampling between different families. Among the pairs of families compared, biases were observed in less than $11\%$ across all the invaded ranges. This implies that although some families may have more species records than others, majority of family pairs compared had no bias. 

However, when assessed at species level, we observe no difference in sampling intensity $(ANOVA\  p.values\ >\ 0.05)$ between observations across the species pairs compared as shown below:

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
# AUS GLONAF
fit_records_aus_glonaf_by_species = aov(val ~ Taxonomic_Group , data = assessRecordNumber_aus_glonaf_by_species)
summary_fit_records_aus_glonaf_by_species = fit_records_aus_glonaf_by_species |> summary()
p.value_aus_glonaf_by_species = (summary_fit_records_aus_glonaf_by_species |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` 



# GBR
fit_records_gbr_by_species = aov(val ~ Taxonomic_Group , data = assessRecordNumber_gbr_by_species)
summary_fit_records_gbr_by_species = fit_records_gbr_by_species |> summary()
p.value_gbr_by_species = (summary_fit_records_gbr_by_species |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)


# IRL
fit_records_irl_by_species = aov(val ~ Taxonomic_Group , data = assessRecordNumber_irl_by_species)
summary_fit_records_irl_by_species = fit_records_irl_by_species |> summary()
p.value_irl_by_species = (summary_fit_records_irl_by_species |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)


# JPN
fit_records_jpn_by_species = aov(val ~ Taxonomic_Group , data = assessRecordNumber_jpn_by_species)
summary_fit_records_jpn_by_species = fit_records_jpn_by_species |> summary()
p.value_jpn_by_species = (summary_fit_records_jpn_by_species |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)



# MDG
fit_records_mdg_by_species = aov(val ~ Taxonomic_Group , data = assessRecordNumber_mdg_by_species)
summary_fit_records_mdg_by_species = fit_records_mdg_by_species |> summary()
p.value_mdg_by_species = (summary_fit_records_mdg_by_species |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)


# NZL GLONAF
fit_records_nzl_glonaf_by_species = aov(val ~ Taxonomic_Group , data = assessRecordNumber_nzl_glonaf_by_species)
summary_fit_records_nzl_glonaf_by_species = fit_records_nzl_glonaf_by_species |> summary()
p.value_nzl_glonaf_by_species = (summary_fit_records_nzl_glonaf_by_species |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)


# USA
fit_records_usa_by_species = aov(val ~ Taxonomic_Group , data = assessRecordNumber_usa_by_species)
summary_fit_records_usa_by_species = fit_records_usa_by_species |> summary()
p.value_usa_by_species = (summary_fit_records_usa_by_species |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)


# ZAF
fit_records_zaf_by_species = aov(val ~ Taxonomic_Group , data = assessRecordNumber_zaf_by_species)
summary_fit_records_zaf_by_species = fit_records_zaf_by_species |> summary()
p.value_zaf_by_species = (summary_fit_records_zaf_by_species |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

```


Table 4: ANOVA p-values - Differences in the Number of records across taxonomic groups (species)
```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
dplyr::tibble(
  range = c("AUS GLONAF", "GBR", "IRL", "JPN", "MDG", "NZL GLONAF", "USA", "ZAF"),
  
  `Number of species` = c(
    assessRecordNumber_aus_glonaf_by_species$Taxonomic_Group |> unique() |> length() ,
    assessRecordNumber_gbr_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_irl_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_jpn_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_mdg_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_nzl_glonaf_by_species$Taxonomic_Group |> unique() |> length() ,
    assessRecordNumber_usa_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_zaf_by_species$Taxonomic_Group |> unique() |> length()),
  
  `pairs of species compared` = c(
    assessRecordNumber_aus_glonaf_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_gbr_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_irl_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_jpn_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_mdg_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_nzl_glonaf_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_usa_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_zaf_by_species$Taxonomic_Group |> unique() |> length() |> choose(2)),
  
  
  `pairs of species with bias` = c(
    species_differences_aus_glonaf |> nrow(),
    species_differences_gbr |> nrow(),
    species_differences_irl |> nrow(),
    species_differences_jpn |> nrow(),
    species_differences_mdg |> nrow(),
    species_differences_nzl_glonaf |> nrow(),
    species_differences_usa |> nrow(),
    species_differences_zaf |> nrow()),
  
  `number of species with bias` = c(
    biased_groups_aus_glonaf |> unique() |> length(),
    biased_groups_gbr |> unique() |> length(),
    biased_groups_irl |> unique() |> length(),
    biased_groups_jpn |> unique() |> length(),
    biased_groups_mdg |> unique() |> length(),
    biased_groups_nzl_glonaf |> unique() |> length(),
    biased_groups_usa |> unique() |> length(),
    biased_groups_zaf |> unique() |> length()),
  
  `% of species with bias` = round(100 * `number of species with bias` / `number of species`, 2),
  
  `% of species pairs with bias` = round(100 * `pairs of species with bias` / `pairs of species compared`, 2),
  
  `ANOVA p.value` = c(p.value_aus_glonaf_by_species, p.value_gbr_by_species, p.value_irl_by_species, p.value_jpn_by_species, p.value_mdg_by_species, p.value_nzl_glonaf_by_species, p.value_usa_by_species, p.value_zaf_by_species)) |> 
  dplyr::mutate(`ANOVA p.value` = round(`ANOVA p.value`, 4)) |>
  knitr::kable()
```






However, when we aggregate the observations into 50-year periods, we observe differences in sampling intensities (ANOVA p.values < 0.05) in 5 of the eight regions (i.e. AUS GLONAF, GBR, MDG, USA and ZAF)  as shown below:



```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(here)
library(readr)
library(ggplot2)
library(gridExtra)
```


*Function to aggregate the number of observations in 10 year periods into 50 year periods*

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
aggregate_50 = function(region) {
  data_path = paste0(here(), "/13.  bias assessment results/", region, "_invaded_clean/", region, "_invaded_clean_periods_length_10_by_species_assessRecordNumber_output.csv")
  data = readr::read_csv(data_path)
  
  periods = dplyr::tibble(Period = data$Period |> unique())
  new_periods = NULL
  
  for (i in 1:ceiling(max(data$Period)/5)) {
    new_periods = c(new_periods, rep(i, 5))
  }
  
  periods$new_periods = new_periods[1:nrow(periods)]
  data = data |>
    dplyr::left_join(periods) |>
    dplyr::select(-Period) |>
    dplyr::group_by(group, new_periods) |>
    dplyr::summarise(val = sum(val)) 
  
  return(data)
}
```


*plot aggregated the data*

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
regions = c("aus_glonaf", "gbr", "irl", "jpn", "mdg", "nzl_glonaf", "usa", "zaf")

for (region in regions) {
  plot = aggregate_50(region = region) |> assign(x = region) |>
    dplyr::filter(!is.na(val)) |>
    dplyr::rename(Period = new_periods) |>
    ggplot(mapping = aes(x = Period, y = val, color = group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of records recorded", 
                    title = paste(region, "- Sampling Intensity (Number of records) for 50 year periods by  Family")) +
  theme(legend.position = "none")
  
  assign(x = region, value = plot)
}

grid.arrange(aus_glonaf, gbr, ncol = 2)
grid.arrange(irl, jpn, ncol = 2)
grid.arrange(mdg, nzl_glonaf, ncol = 2)
grid.arrange(usa, zaf, ncol = 2)
```


*ANOVA with aggregated data*

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
anova_test = function(region) {
  data = aggregate_50(region = region) |> dplyr::rename(Taxonomic_Group = group)
  
   fit_species = aov(val ~ Taxonomic_Group , 
                     data = data)
   summary_fit_species = fit_species |> summary()
   p.value = (summary_fit_species |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

   return(list(fit_species = fit_species, summary_fit_species = summary_fit_species,
               p.value = p.value))
}


for (region in regions) {
  anova_test(region = region) |> assign(x = paste0("anova_", region))
}


for (region in regions) {
  (aggregate_50(region = region) |> dplyr::rename(Taxonomic_Group = group)) |> assign(x = paste0("assessRecordNumber_", region, "_by_species"))
}


# AnOVAtable
dplyr::tibble(
  range = c("AUS GLONAF", "GBR", "IRL", "JPN", "MDG", "NZL GLONAF", "USA", "ZAF"),
  
  `Number of records` = c(
    assessRecordNumber_aus_glonaf_by_species$Taxonomic_Group |> unique() |> length() ,
    assessRecordNumber_gbr_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_irl_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_jpn_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_mdg_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_nzl_glonaf_by_species$Taxonomic_Group |> unique() |> length() ,
    assessRecordNumber_usa_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_zaf_by_species$Taxonomic_Group |> unique() |> length()),
  
  `pairs of species compared` = c(
    assessRecordNumber_aus_glonaf_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_gbr_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_irl_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_jpn_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_mdg_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_nzl_glonaf_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_usa_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessRecordNumber_zaf_by_species$Taxonomic_Group |> unique() |> length() |> choose(2)),

  `ANOVA p.value` = c(anova_aus_glonaf$p.value, anova_gbr$p.value, anova_irl$p.value, anova_jpn$p.value, 
                      anova_mdg$p.value, anova_nzl_glonaf$p.value, anova_usa$p.value, anova_zaf$p.value)) |> 
  dplyr::mutate(`ANOVA p.value` = round(`ANOVA p.value`, 4)) |>
  knitr::kable()
```

This implies that differences in sampling intensity become more apparent when the species observations are aggregated at higher taxonomic levels (e.g the family level) or aggregated into periods with longer durations (e.g increasing duration of each period from 10 years to 50 years). This supports the assumption that differences in sampling intensity would be higher in aggregated groups rather than individuals. Therefore, aggregating occurrences at larger  taxonomic and temporal scales show more difference in sampling intensity than at smaller scales.

Taxonomic groups (families) identified to have significant differences in sampling intensity are identified and ranked for the different regions based on the differences

Table: Differences in the Number of records identified between families
```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
s_differences = (species_differences_aus_glonaf |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "AUS GLONAF")) |>

dplyr::full_join(species_differences_gbr |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "GBR")) |>

dplyr::full_join(species_differences_irl |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "IRL")) |>

dplyr::full_join(species_differences_jpn |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "JPN")) |>

dplyr::full_join(species_differences_mdg |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "MDG")) |>

dplyr::full_join(species_differences_nzl_glonaf |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "NZL GLONAF")) |>

dplyr::full_join(species_differences_usa |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "USA")) |>

dplyr::full_join(species_differences_zaf |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "ZAF")) |>
  
  dplyr::select(region, group_1, group_2, difference, lower_conf_limit, upper_conf_limit, `p value`) 


s_differences[ , c(4, 5, 6)] = s_differences[ , c(4, 5, 6)] |> round(2)
s_differences[ , 7] = s_differences[ , 7] |> round(4)

s_differences |>
  knitr::kable()

```


## (b) Temporal biases in Sampling Intensity

We observed a positive slope in the Number of records identified over time among some families across all the regions (figure 1). We estimate the slopes of the Number of records recorded for each family over time, and test the alternative hypothesis that there is a temporal change in sampling intensity (i.e slope > 0). 



```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(broom)
library(purrr)

# BY FAMILY

# aus_glonaf
sampling_intensity_slope_aus_glonaf = split.data.frame(assessRecordNumber_aus_glonaf, assessRecordNumber_aus_glonaf$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_aus_glonaf$Taxonomic_Group |> unique()), region = "aus_glonaf") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_aus_glonaf = sampling_intensity_slope_aus_glonaf[sampling_intensity_slope_aus_glonaf$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_aus_glonaf = sampling_intensity_slope_aus_glonaf[sampling_intensity_slope_aus_glonaf$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# gbr
sampling_intensity_slope_gbr = split.data.frame(assessRecordNumber_gbr, assessRecordNumber_gbr$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_gbr$Taxonomic_Group |> unique()), region = "gbr") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_gbr = sampling_intensity_slope_gbr[sampling_intensity_slope_gbr$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_gbr = sampling_intensity_slope_gbr[sampling_intensity_slope_gbr$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# irl
sampling_intensity_slope_irl = split.data.frame(assessRecordNumber_irl, assessRecordNumber_irl$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_irl$Taxonomic_Group |> unique()), region = "irl") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_irl = sampling_intensity_slope_irl[sampling_intensity_slope_irl$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_irl = sampling_intensity_slope_irl[sampling_intensity_slope_irl$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# jpn
sampling_intensity_slope_jpn = split.data.frame(assessRecordNumber_jpn, assessRecordNumber_jpn$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_jpn$Taxonomic_Group |> unique()), region = "jpn") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_jpn = sampling_intensity_slope_jpn[sampling_intensity_slope_jpn$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_jpn = sampling_intensity_slope_jpn[sampling_intensity_slope_jpn$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# mdg
sampling_intensity_slope_mdg = split.data.frame(assessRecordNumber_mdg, assessRecordNumber_mdg$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_mdg$Taxonomic_Group |> unique()), region = "mdg") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_mdg = sampling_intensity_slope_mdg[sampling_intensity_slope_mdg$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_mdg = sampling_intensity_slope_mdg[sampling_intensity_slope_mdg$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# nzl_glonaf
sampling_intensity_slope_nzl_glonaf = split.data.frame(assessRecordNumber_nzl_glonaf, assessRecordNumber_nzl_glonaf$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_nzl_glonaf$Taxonomic_Group |> unique()), region = "nzl_glonaf") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_nzl_glonaf = sampling_intensity_slope_nzl_glonaf[sampling_intensity_slope_nzl_glonaf$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_nzl_glonaf = sampling_intensity_slope_nzl_glonaf[sampling_intensity_slope_nzl_glonaf$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# usa
sampling_intensity_slope_usa = split.data.frame(assessRecordNumber_usa, assessRecordNumber_usa$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_usa$Taxonomic_Group |> unique()), region = "usa") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_usa = sampling_intensity_slope_usa[sampling_intensity_slope_usa$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_usa = sampling_intensity_slope_usa[sampling_intensity_slope_usa$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# zaf
sampling_intensity_slope_zaf = split.data.frame(assessRecordNumber_zaf, assessRecordNumber_zaf$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_zaf$Taxonomic_Group |> unique()), region = "zaf") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_zaf = sampling_intensity_slope_zaf[sampling_intensity_slope_zaf$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_zaf = sampling_intensity_slope_zaf[sampling_intensity_slope_zaf$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


dplyr::tibble(
  range = c("AUS GLONAF", "GBR", "IRL", "JPN", "MDG", "NZL GLONAF", "USA", "ZAF"),
  
  `number of families` = c(
    assessRecordNumber_aus_glonaf$Taxonomic_Group |> unique() |> length() ,
    assessRecordNumber_gbr$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_irl$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_jpn$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_mdg$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_nzl_glonaf$Taxonomic_Group |> unique() |> length() ,
    assessRecordNumber_usa$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_zaf$Taxonomic_Group |> unique() |> length()),
  
  `families with increasing sampling` = c(
    increasing_coverage_aus_glonaf, increasing_coverage_gbr, increasing_coverage_irl,
    increasing_coverage_jpn, increasing_coverage_mdg, increasing_coverage_nzl_glonaf,
    increasing_coverage_usa, increasing_coverage_zaf
  ),
  
  `families with decreasing sampling` = c(
    decreasing_coverage_aus_glonaf, decreasing_coverage_gbr, decreasing_coverage_irl,
    decreasing_coverage_jpn, decreasing_coverage_mdg, decreasing_coverage_nzl_glonaf,
    decreasing_coverage_usa, decreasing_coverage_zaf
  ),
  
  `% of families with increasing sampling` = round(100 * `families with increasing sampling` / `number of families`, 2),
  
  `% of families with decreasing sampling` =  round(100 * `families with decreasing sampling` / `number of families`, 2),
  
  `% of families without temporal changes` = 100 - (`% of families with increasing sampling` + `% of families with decreasing sampling`)) |>
  
  knitr::kable()
```


Temporal changes in sampling intensity were observed in between 16% (IRL) and 62.39% (GBR) of families across the  8 invaded regions. Increases in sampling intensities were more dominant than decreases among the families where temporal changes were observed.  



```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(broom)
# BY species

# aus_glonaf
sampling_intensity_slope_aus_glonaf_by_species = split.data.frame( assessRecordNumber_aus_glonaf_by_species,  assessRecordNumber_aus_glonaf_by_species$Taxonomic_Group)  |> 
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort( assessRecordNumber_aus_glonaf_by_species$Taxonomic_Group |> unique()), region = "aus_glonaf") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_aus_glonaf_by_species = sampling_intensity_slope_aus_glonaf_by_species[sampling_intensity_slope_aus_glonaf_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_aus_glonaf_by_species = sampling_intensity_slope_aus_glonaf_by_species[sampling_intensity_slope_aus_glonaf_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# gbr
sampling_intensity_slope_gbr_by_species = split.data.frame(assessRecordNumber_gbr_by_species, assessRecordNumber_gbr_by_species$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_gbr_by_species$Taxonomic_Group |> unique()), region = "gbr") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_gbr_by_species = sampling_intensity_slope_gbr_by_species[sampling_intensity_slope_gbr_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_gbr_by_species = sampling_intensity_slope_gbr_by_species[sampling_intensity_slope_gbr_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# irl
sampling_intensity_slope_irl_by_species = split.data.frame(assessRecordNumber_irl_by_species, assessRecordNumber_irl_by_species$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_irl_by_species$Taxonomic_Group |> unique()), region = "irl") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_irl_by_species = sampling_intensity_slope_irl_by_species[sampling_intensity_slope_irl_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_irl_by_species = sampling_intensity_slope_irl_by_species[sampling_intensity_slope_irl_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# jpn
sampling_intensity_slope_jpn_by_species = split.data.frame(assessRecordNumber_jpn_by_species, assessRecordNumber_jpn_by_species$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_jpn_by_species$Taxonomic_Group |> unique()), region = "jpn") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_jpn_by_species = sampling_intensity_slope_jpn_by_species[sampling_intensity_slope_jpn_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_jpn_by_species = sampling_intensity_slope_jpn_by_species[sampling_intensity_slope_jpn_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# mdg
sampling_intensity_slope_mdg_by_species = split.data.frame(assessRecordNumber_mdg_by_species, assessRecordNumber_mdg_by_species$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_mdg_by_species$Taxonomic_Group |> unique()), region = "mdg") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_mdg_by_species = sampling_intensity_slope_mdg_by_species[sampling_intensity_slope_mdg_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_mdg_by_species = sampling_intensity_slope_mdg_by_species[sampling_intensity_slope_mdg_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# nzl_glonaf
sampling_intensity_slope_nzl_glonaf_by_species = split.data.frame(assessRecordNumber_nzl_glonaf_by_species, assessRecordNumber_nzl_glonaf_by_species$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_nzl_glonaf_by_species$Taxonomic_Group |> unique()), region = "nzl_glonaf") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_nzl_glonaf_by_species = sampling_intensity_slope_nzl_glonaf_by_species[sampling_intensity_slope_nzl_glonaf_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_nzl_glonaf_by_species = sampling_intensity_slope_nzl_glonaf_by_species[sampling_intensity_slope_nzl_glonaf_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# usa
sampling_intensity_slope_usa_by_species = split.data.frame(assessRecordNumber_usa_by_species, assessRecordNumber_usa_by_species$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_usa_by_species$Taxonomic_Group |> unique()), region = "usa") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_usa_by_species = sampling_intensity_slope_usa_by_species[sampling_intensity_slope_usa_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_usa_by_species = sampling_intensity_slope_usa_by_species[sampling_intensity_slope_usa_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# zaf
sampling_intensity_slope_zaf_by_species = split.data.frame(assessRecordNumber_zaf_by_species, assessRecordNumber_zaf_by_species$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessRecordNumber_zaf_by_species$Taxonomic_Group |> unique()), region = "zaf") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_zaf_by_species = sampling_intensity_slope_zaf_by_species[sampling_intensity_slope_zaf_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_zaf_by_species = sampling_intensity_slope_zaf_by_species[sampling_intensity_slope_zaf_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


dplyr::tibble(
  range = c("AUS GLONAF", "GBR", "IRL", "JPN", "MDG", "NZL GLONAF", "USA", "ZAF"),
  
  `Number of records` = c(
    assessRecordNumber_aus_glonaf_by_species$Taxonomic_Group |> unique() |> length() ,
    assessRecordNumber_gbr_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_irl_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_jpn_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_mdg_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_nzl_glonaf_by_species$Taxonomic_Group |> unique() |> length() ,
    assessRecordNumber_usa_by_species$Taxonomic_Group |> unique() |> length(),
    assessRecordNumber_zaf_by_species$Taxonomic_Group |> unique() |> length()),
  
  `species with increasing sampling` = c(
    increasing_coverage_aus_glonaf_by_species, increasing_coverage_gbr_by_species, increasing_coverage_irl_by_species,
    increasing_coverage_jpn_by_species, increasing_coverage_mdg_by_species, increasing_coverage_nzl_glonaf_by_species,
    increasing_coverage_usa_by_species, increasing_coverage_zaf_by_species
  ),
  
  `species with decreasing sampling` = c(
    decreasing_coverage_aus_glonaf_by_species, decreasing_coverage_gbr_by_species, decreasing_coverage_irl_by_species,
    decreasing_coverage_jpn_by_species, decreasing_coverage_mdg_by_species, decreasing_coverage_nzl_glonaf_by_species,
    decreasing_coverage_usa_by_species, decreasing_coverage_zaf_by_species
  ),
  
  `% of species with increasing sampling` = round(100 * `species with increasing sampling` / `Number of records`, 2),
  
  `% of species with decreasing sampling` =  round(100 * `species with decreasing sampling` / `Number of records`, 2),
  
  `% of species without temporal changes` = 100 - (`% of species with increasing sampling` + `% of species with decreasing sampling`)) |>
  
  knitr::kable()
```


In contrast, when occurrences are aggregated at species level, instances of temporal change in sampling intensity decrease to between 0% (IRL) and 18.86% (GBR). Here, decreases in sampling intensities were more dominant than increases  among the species  where temporal changes were observed.  
This suggests that aggregation at larger taxonomic scales makes temporal changes in sampling intensity more visible than at smaller scales. 

# _____________________________________________________________

# 2. Taxonomic Sampling biases

We use the following measures to assess taxonomic sampling bias:

- differences in the number of species identified between taxonomic groups
- changes in the number of species identified over time (temporal Sampling intensity bias)
- whether rare species are under/over-represented in the data 


## (a) Number of species identified

### (i) by taxonomic group 

**(Family)**

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(dplyr)
## AUS GLONAF
file_link_aus_glonaf = here("13.  bias assessment results", "aus_glonaf_invaded_clean", directory_files_aus_glonaf[grepl("assessSpeciesNumber_output", directory_files_aus_glonaf)])

file_link_aus_glonaf = file_link_aus_glonaf[!grepl("species", file_link_aus_glonaf)]
assessSpeciesNumber_aus_glonaf = read.csv(file = file_link_aus_glonaf) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 
  
assessSpeciesNumber_aus_glonaf = assessSpeciesNumber_aus_glonaf |> 
  merge(periods_range_aus_glonaf, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group) 

## GBR
file_link_gbr = here("13.  bias assessment results", "gbr_invaded_clean", directory_files_gbr[grepl("assessSpeciesNumber_output", directory_files_gbr)])

file_link_gbr = file_link_gbr[!grepl("species", file_link_gbr)]
assessSpeciesNumber_gbr = read.csv(file = file_link_gbr) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessSpeciesNumber_gbr = assessSpeciesNumber_gbr |> 
  merge(periods_range_gbr, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## IRL
file_link_irl = here("13.  bias assessment results", "irl_invaded_clean", directory_files_irl[grepl("assessSpeciesNumber_output", directory_files_irl)])

file_link_irl = file_link_irl[!grepl("species", file_link_irl)]
assessSpeciesNumber_irl = read.csv(file = file_link_irl) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessSpeciesNumber_irl = assessSpeciesNumber_irl |> 
  merge(periods_range_irl, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## JPN
file_link_jpn = here("13.  bias assessment results", "jpn_invaded_clean", directory_files_jpn[grepl("assessSpeciesNumber_output", directory_files_jpn)])

file_link_jpn = file_link_jpn[!grepl("species", file_link_jpn)]
assessSpeciesNumber_jpn = read.csv(file = file_link_jpn) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessSpeciesNumber_jpn = assessSpeciesNumber_jpn |> 
  merge(periods_range_jpn, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## MDG
file_link_mdg = here("13.  bias assessment results", "mdg_invaded_clean", directory_files_mdg[grepl("assessSpeciesNumber_output", directory_files_mdg)])

file_link_mdg = file_link_mdg[!grepl("species", file_link_mdg)]
assessSpeciesNumber_mdg = read.csv(file = file_link_mdg) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessSpeciesNumber_mdg = assessSpeciesNumber_mdg |> 
  merge(periods_range_mdg, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## NZL GLONAF
file_link_nzl_glonaf = here("13.  bias assessment results", "nzl_glonaf_invaded_clean", directory_files_nzl_glonaf[grepl("assessSpeciesNumber_output", directory_files_nzl_glonaf)])

file_link_nzl_glonaf = file_link_nzl_glonaf[!grepl("species", file_link_nzl_glonaf)]
assessSpeciesNumber_nzl_glonaf = read.csv(file = file_link_nzl_glonaf) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessSpeciesNumber_nzl_glonaf = assessSpeciesNumber_nzl_glonaf |> 
  merge(periods_range_nzl_glonaf, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## USA
file_link_usa = here("13.  bias assessment results", "usa_invaded_clean", directory_files_usa[grepl("assessSpeciesNumber_output", directory_files_usa)])

file_link_usa = file_link_usa[!grepl("species", file_link_usa)]
assessSpeciesNumber_usa = read.csv(file = file_link_usa) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessSpeciesNumber_usa = assessSpeciesNumber_usa |> 
  merge(periods_range_usa, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)

## ZAF
file_link_zaf = here("13.  bias assessment results", "zaf_invaded_clean", directory_files_zaf[grepl("assessSpeciesNumber_output", directory_files_zaf)])

file_link_zaf = file_link_zaf[!grepl("species", file_link_zaf)]
assessSpeciesNumber_zaf = read.csv(file = file_link_zaf) |>
  group_by(group) |>
  summarise(Period = Period, 
            val = val / max(val, na.rm = T)) 

assessSpeciesNumber_zaf = assessSpeciesNumber_zaf |> 
  merge(periods_range_zaf, by.x = "Period", by.y = "Period") |>
  na.omit() |> dplyr::filter(val != 0) |> dplyr::rename(Taxonomic_Group = group)
```

The set of figures below (Figure 1) visualize the cumulative number of observations recorded for different *families* over the occurrence periods in the respective occurrence ranges. 

Figure 1: Number of recorded *species per family* over time
```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(ggplot2)

## AUS GLONAF
species_number_aus_glonaf = assessSpeciesNumber_aus_glonaf |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of species recorded", 
                    title = "AUS GLONAF - Sampling Intensity \n  (Number of species) by  Family") +
  theme(legend.position = "none")

## GBR
species_number_gbr = assessSpeciesNumber_gbr |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of species recorded", 
                    title = "GBR - Sampling Intensity \n  (Number of species) by  Family") +
  theme(legend.position = "none")

## IRL
species_number_irl = assessSpeciesNumber_irl |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of species recorded", 
                    title = "IRL - Sampling Intensity \n  (Number of species) by  Family") +
  theme(legend.position = "none")

## JPN
species_number_jpn = assessSpeciesNumber_jpn |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of species recorded", 
                    title = "JPN - Sampling Intensity \n  (Number of species) by  Family") +
  theme(legend.position = "none")

## MDG
species_number_mdg = assessSpeciesNumber_mdg |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of species recorded", 
                    title = "MDG - Sampling Intensity \n  (Number of species) by  Family") +
  theme(legend.position = "none")

## NZL GLONAF
species_number_nzl_glonaf = assessSpeciesNumber_nzl_glonaf |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of species recorded", 
                    title = "NZL GLONAF - Sampling Intensity \n  (Number of species) by  Family") +
  theme(legend.position = "none")

## USA
species_number_usa = assessSpeciesNumber_usa |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of species recorded", 
                    title = "USA - Sampling Intensity \n  (Number of species) by  Family") +
  theme(legend.position = "none")

## ZAF
species_number_zaf = assessSpeciesNumber_zaf |>
  dplyr::filter(!is.na(val)) |>
  ggplot(mapping = aes(x = Period, y = val, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of species recorded", 
                    title = "ZAF - Sampling Intensity \n  (Number of species) by  Family") +
  theme(legend.position = "none")


grid.arrange(species_number_aus_glonaf, species_number_gbr, ncol = 2)
grid.arrange(species_number_irl, species_number_jpn, ncol = 2)
grid.arrange(species_number_mdg, species_number_nzl_glonaf, ncol = 2)
grid.arrange(species_number_usa, species_number_zaf, ncol = 2)
```





We observe:

(a) An apparent difference in the Number of records identified across taxonomic groups (families). We use the *Analysis of Variance (ANOVA)* to test whether the observed differences in the Number of records identified between families are significant. The *Tukey multiple comparison test* helps us compare pairs of taxonomic groups and identify those with significantly more samples (*presence of taxonomic bias*).

(b) A general increase in the Number of records identified across the periods. We estimate the *slopes* of the per-period Number of records observations for the different families and identify the families with *slopes significantly different from 0*, which imply a change in the Number of records observations over time (*presence of temporal change in taxonomic bias*) 




```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
# **(Family)**

# AUS GLONAF
fit_species_aus_glonaf = aov(val ~ Taxonomic_Group , data = assessSpeciesNumber_aus_glonaf)
summary_fit_species_aus_glonaf = fit_species_aus_glonaf |> summary()
p.value_aus_glonaf = (summary_fit_species_aus_glonaf |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_aus_glonaf = TukeyHSD(fit_species_aus_glonaf, "Taxonomic_Group")

x = table(assessSpeciesNumber_aus_glonaf$Taxonomic_Group)
species_differences_aus_glonaf2 = tukey_species_aus_glonaf$Taxonomic_Group |> as.data.frame() 
for (i in length(x):1) {
    species_differences_aus_glonaf2[grepl(x = species_differences_aus_glonaf2 |> row.names(), pattern = names(x)[i]), "count"] = paste(species_differences_aus_glonaf2[grepl(x = species_differences_aus_glonaf2 |> row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_aus_glonaf2$count = gsub("NA, ", "", species_differences_aus_glonaf2$count)

species_differences_aus_glonaf = tukey_species_aus_glonaf$Taxonomic_Group[!(tukey_species_aus_glonaf$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_aus_glonaf = cbind(data.frame(do.call(rbind, (rownames(species_differences_aus_glonaf) |> strsplit(split = "-")))),
      species_differences_aus_glonaf)

## groups with bias
biased_groups_aus_glonaf = rownames(species_differences_aus_glonaf) |> strsplit(split = "-") |>
  unlist()


# GBR
fit_species_gbr = aov(val ~ Taxonomic_Group , data = assessSpeciesNumber_gbr)
summary_fit_species_gbr = fit_species_gbr |> summary()
p.value_gbr = (summary_fit_species_gbr |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_gbr = TukeyHSD(fit_species_gbr, "Taxonomic_Group")

x = table(assessSpeciesNumber_gbr$Taxonomic_Group) 
species_differences_gbr2 = tukey_species_gbr$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_gbr2[grepl(x = species_differences_gbr2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_gbr2[grepl(x = species_differences_gbr2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_gbr2$count = gsub("NA, ", "", species_differences_gbr2$count)

species_differences_gbr = tukey_species_gbr$Taxonomic_Group[!(tukey_species_gbr$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_gbr = cbind(data.frame(do.call(rbind, (rownames(species_differences_gbr) |> strsplit(split = "-")))),
      species_differences_gbr)

## groups with bias
biased_groups_gbr = rownames(species_differences_gbr) |> strsplit(split = "-") |>
  unlist()


# IRL
fit_species_irl = aov(val ~ Taxonomic_Group , data = assessSpeciesNumber_irl)
summary_fit_species_irl = fit_species_irl |> summary()
p.value_irl = (summary_fit_species_irl |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_irl = TukeyHSD(fit_species_irl, "Taxonomic_Group")

x = table(assessSpeciesNumber_irl$Taxonomic_Group) 
species_differences_irl2 = tukey_species_irl$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_irl2[grepl(x = species_differences_irl2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_irl2[grepl(x = species_differences_irl2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_irl2$count = gsub("NA, ", "", species_differences_irl2$count)

species_differences_irl = tukey_species_irl$Taxonomic_Group[!(tukey_species_irl$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_irl = cbind(data.frame(do.call(rbind, (rownames(species_differences_irl) |> strsplit(split = "-")))),
      species_differences_irl)

## groups with bias
biased_groups_irl = rownames(species_differences_irl) |> strsplit(split = "-") |>
  unlist()


# JPN
fit_species_jpn = aov(val ~ Taxonomic_Group , data = assessSpeciesNumber_jpn)
summary_fit_species_jpn = fit_species_jpn |> summary()
p.value_jpn = (summary_fit_species_jpn |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_jpn = TukeyHSD(fit_species_jpn, "Taxonomic_Group")

x = table(assessSpeciesNumber_jpn$Taxonomic_Group) 
species_differences_jpn2 = tukey_species_jpn$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_jpn2[grepl(x = species_differences_jpn2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_jpn2[grepl(x = species_differences_jpn2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_jpn2$count = gsub("NA, ", "", species_differences_jpn2$count)

species_differences_jpn = tukey_species_jpn$Taxonomic_Group[!(tukey_species_jpn$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_jpn = cbind(data.frame(do.call(rbind, (rownames(species_differences_jpn) |> strsplit(split = "-")))),
      species_differences_jpn)

## groups with bias
biased_groups_jpn = rownames(species_differences_jpn) |> strsplit(split = "-") |>
  unlist()


# MDG
fit_species_mdg = aov(val ~ Taxonomic_Group , data = assessSpeciesNumber_mdg)
summary_fit_species_mdg = fit_species_mdg |> summary()
p.value_mdg = (summary_fit_species_mdg |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_mdg = TukeyHSD(fit_species_mdg, "Taxonomic_Group")

x = table(assessSpeciesNumber_mdg$Taxonomic_Group) 
species_differences_mdg2 = tukey_species_mdg$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_mdg2[grepl(x = species_differences_mdg2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_mdg2[grepl(x = species_differences_mdg2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_mdg2$count = gsub("NA, ", "", species_differences_mdg2$count)

species_differences_mdg = tukey_species_mdg$Taxonomic_Group[!(tukey_species_mdg$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_mdg = cbind(data.frame(do.call(rbind, (rownames(species_differences_mdg) |> strsplit(split = "-")))),
      species_differences_mdg)

## groups with bias
biased_groups_mdg = rownames(species_differences_mdg) |> strsplit(split = "-") |>
  unlist()


# NZL GLONAF
fit_species_nzl_glonaf = aov(val ~ Taxonomic_Group , data = assessSpeciesNumber_nzl_glonaf)
summary_fit_species_nzl_glonaf = fit_species_nzl_glonaf |> summary()
p.value_nzl_glonaf = (summary_fit_species_nzl_glonaf |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_nzl_glonaf = TukeyHSD(fit_species_nzl_glonaf, "Taxonomic_Group")

x = table(assessSpeciesNumber_nzl_glonaf$Taxonomic_Group) 
species_differences_nzl_glonaf2 = tukey_species_nzl_glonaf$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_nzl_glonaf2[grepl(x = species_differences_nzl_glonaf2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_nzl_glonaf2[grepl(x = species_differences_nzl_glonaf2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_nzl_glonaf2$count = gsub("NA, ", "", species_differences_nzl_glonaf2$count)

species_differences_nzl_glonaf = tukey_species_nzl_glonaf$Taxonomic_Group[!(tukey_species_nzl_glonaf$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_nzl_glonaf = cbind(data.frame(do.call(rbind, (rownames(species_differences_nzl_glonaf) |> strsplit(split = "-")))),
      species_differences_nzl_glonaf)

## groups with bias
biased_groups_nzl_glonaf = rownames(species_differences_nzl_glonaf) |> strsplit(split = "-") |>
  unlist()


# USA
fit_species_usa = aov(val ~ Taxonomic_Group , data = assessSpeciesNumber_usa)
summary_fit_species_usa = fit_species_usa |> summary()
p.value_usa = (summary_fit_species_usa |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_usa = TukeyHSD(fit_species_usa, "Taxonomic_Group")

x = table(assessSpeciesNumber_usa$Taxonomic_Group) 
species_differences_usa2 = tukey_species_usa$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_usa2[grepl(x = species_differences_usa2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_usa2[grepl(x = species_differences_usa2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_usa2$count = gsub("NA, ", "", species_differences_usa2$count)

species_differences_usa = tukey_species_usa$Taxonomic_Group[!(tukey_species_usa$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_usa = cbind(data.frame(do.call(rbind, (rownames(species_differences_usa) |> strsplit(split = "-")))),
      species_differences_usa)

## groups with bias
biased_groups_usa = rownames(species_differences_usa) |> strsplit(split = "-") |>
  unlist()


# ZAF
fit_species_zaf = aov(val ~ Taxonomic_Group , data = assessSpeciesNumber_zaf)
summary_fit_species_zaf = fit_species_zaf |> summary()
p.value_zaf = (summary_fit_species_zaf |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

## tukey test
tukey_species_zaf = TukeyHSD(fit_species_zaf, "Taxonomic_Group")

x = table(assessSpeciesNumber_zaf$Taxonomic_Group) 
species_differences_zaf2 = tukey_species_zaf$Taxonomic_Group |> as.data.frame() 

for (i in length(x):1) {
  species_differences_zaf2[grepl(x = species_differences_zaf2 |> row.names(), 
                                        pattern = names(x)[i]), "count"] = paste(species_differences_zaf2[grepl(x = species_differences_zaf2 |>
                                                                                                                         row.names(), pattern = names(x)[i]), "count"], x[i], sep = ", ")
} 

species_differences_zaf2$count = gsub("NA, ", "", species_differences_zaf2$count)

species_differences_zaf = tukey_species_zaf$Taxonomic_Group[!(tukey_species_zaf$Taxonomic_Group[, "p adj"] > 0.05) , ] |> as.data.frame() |>  
  dplyr::arrange(desc(abs(diff))) |>
  dplyr::rename(difference = diff)

species_differences_zaf = cbind(data.frame(do.call(rbind, (rownames(species_differences_zaf) |> strsplit(split = "-")))),
      species_differences_zaf)

## groups with bias
biased_groups_zaf = rownames(species_differences_zaf) |> strsplit(split = "-") |>
  unlist()
```



Table 3 below gives the p-value of the *ANOVA* tests for the different occurrence ranges. The *P-values < 0.05* imply presence of a significant variation in the Number of records identified between some of the families in the datasets. 

Table 3: ANOVA p-values - Differences in the Number of records across taxonomic groups (families)
```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
## **(species)**

dplyr::tibble(
  range = c("AUS GLONAF", "GBR", "IRL", "JPN", "MDG", "NZL GLONAF", "USA", "ZAF"),
  
  `number of families` = c(
    assessSpeciesNumber_aus_glonaf$Taxonomic_Group |> unique() |> length() ,
    assessSpeciesNumber_gbr$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_irl$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_jpn$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_mdg$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_nzl_glonaf$Taxonomic_Group |> unique() |> length() ,
    assessSpeciesNumber_usa$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_zaf$Taxonomic_Group |> unique() |> length()),
  
  `pairs of families compared` = c(
    assessSpeciesNumber_aus_glonaf$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_gbr$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_irl$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_jpn$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_mdg$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_nzl_glonaf$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_usa$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_zaf$Taxonomic_Group |> unique() |> length() |> choose(2)),
  
  `pairs of families with bias` = c(
    species_differences_aus_glonaf |> nrow(),
    species_differences_gbr |> nrow(),
    species_differences_irl |> nrow(),
    species_differences_jpn |> nrow(),
    species_differences_mdg |> nrow(),
    species_differences_nzl_glonaf |> nrow(),
    species_differences_usa |> nrow(),
    species_differences_zaf |> nrow()),
  
  `number of families with bias` = c(
    biased_groups_aus_glonaf |> unique() |> length(),
    biased_groups_gbr |> unique() |> length(),
    biased_groups_irl |> unique() |> length(),
    biased_groups_jpn |> unique() |> length(),
    biased_groups_mdg |> unique() |> length(),
    biased_groups_nzl_glonaf |> unique() |> length(),
    biased_groups_usa |> unique() |> length(),
    biased_groups_zaf |> unique() |> length()),
  
  `% of families with bias` = round(100 * `number of families with bias` / `number of families`, 2),
  
  `% of family pairs with bias` = round(100 * `pairs of families with bias` / `pairs of families compared`, 2),
  
  `ANOVA p.value` = c(p.value_aus_glonaf, p.value_gbr, p.value_irl, p.value_jpn, p.value_mdg, p.value_nzl_glonaf, p.value_usa, p.value_zaf)) |> 
  dplyr::mutate(`ANOVA p.value` = round(`ANOVA p.value`, 4)) |>
  knitr::kable()
```


Note that although *all families (100% of families assessed)* had some level of taxonomic bias relative to atleast *1 other family* except in *IRL* where only $40\%$ of the families with bias, there is a high level of homogeneity in sampling between different families. Among the pairs of families compared, biases were observed in less than $11\%$ across all the invaded ranges. This implies that although some families may have more species records than others, majority of family pairs compared had no bias. 


```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(here)
library(readr)
library(ggplot2)
library(gridExtra)
```


*Function to aggregate the number of observations in 10 year periods into 50 year periods*

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
aggregate_50 = function(region) {
  data_path = paste0(here(), "/13.  bias assessment results/", region, "_invaded_clean/", region, "_invaded_clean_periods_length_10_by_species_assessSpeciesNumber_output.csv")
  data = readr::read_csv(data_path)
  
  periods = dplyr::tibble(Period = data$Period |> unique())
  new_periods = NULL
  
  for (i in 1:ceiling(max(data$Period)/5)) {
    new_periods = c(new_periods, rep(i, 5))
  }
  
  periods$new_periods = new_periods[1:nrow(periods)]
  data = data |>
    dplyr::left_join(periods) |>
    dplyr::select(-Period) |>
    dplyr::group_by(group, new_periods) |>
    dplyr::summarise(val = sum(val)) 
  
  return(data)
}
```


*plot aggregated the data*

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
regions = c("aus_glonaf", "gbr", "irl", "jpn", "mdg", "nzl_glonaf", "usa", "zaf")

for (region in regions) {
  plot = aggregate_50(region = region) |> assign(x = region) |>
    dplyr::filter(!is.na(val)) |>
    dplyr::rename(Period = new_periods) |>
    ggplot(mapping = aes(x = Period, y = val, color = group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Number of species recorded", 
                    title = paste(region, "- Taxonomic Sampling Bias (Number of species) for 50 year periods by  Family")) +
  theme(legend.position = "none")
  
  assign(x = region, value = plot)
}

grid.arrange(aus_glonaf, gbr, ncol = 2)
grid.arrange(irl, jpn, ncol = 2)
grid.arrange(mdg, nzl_glonaf, ncol = 2)
grid.arrange(usa, zaf, ncol = 2)
```


*ANOVA with aggregated data*

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
anova_test = function(region) {
  data = aggregate_50(region = region) |> dplyr::rename(Taxonomic_Group = group)
  
  # normalize
  data$val = data$val / (max(data$val, na.rm = TRUE))
  
   fit_species = aov(val ~ Taxonomic_Group , 
                     data = data)
   summary_fit_species = fit_species |> summary()
   p.value = (summary_fit_species |> unlist() |> t() |> as.data.frame())$`Pr(>F)1` |> round(5)

   return(list(fit_species = fit_species, summary_fit_species = summary_fit_species,
               p.value = p.value))
}


for (region in regions) {
  anova_test(region = region) |> assign(x = paste0("anova_", region))
}


for (region in regions) {
  (aggregate_50(region = region) |> dplyr::rename(Taxonomic_Group = group)) |> assign(x = paste0("assessSpeciesNumber_", region, "_by_species"))
}


# AnOVA table
dplyr::tibble(
  range = c("AUS GLONAF", "GBR", "IRL", "JPN", "MDG", "NZL GLONAF", "USA", "ZAF"),
  
  `Number of species` = c(
    assessSpeciesNumber_aus_glonaf_by_species$Taxonomic_Group |> unique() |> length() ,
    assessSpeciesNumber_gbr_by_species$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_irl_by_species$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_jpn_by_species$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_mdg_by_species$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_nzl_glonaf_by_species$Taxonomic_Group |> unique() |> length() ,
    assessSpeciesNumber_usa_by_species$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_zaf_by_species$Taxonomic_Group |> unique() |> length()),
  
  `pairs of species compared` = c(
    assessSpeciesNumber_aus_glonaf_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_gbr_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_irl_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_jpn_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_mdg_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_nzl_glonaf_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_usa_by_species$Taxonomic_Group |> unique() |> length() |> choose(2),
    assessSpeciesNumber_zaf_by_species$Taxonomic_Group |> unique() |> length() |> choose(2)),

  `ANOVA p.value` = c(anova_aus_glonaf$p.value, anova_gbr$p.value, anova_irl$p.value, anova_jpn$p.value, 
                      anova_mdg$p.value, anova_nzl_glonaf$p.value, anova_usa$p.value, anova_zaf$p.value)) |> 
  dplyr::mutate(`ANOVA p.value` = round(`ANOVA p.value`, 4)) |>
  knitr::kable()
```

This implies that differences in sampling intensity become more apparent when the species observations are aggregated at higher taxonomic levels (e.g the family level) or aggregated into periods with longer durations (e.g increasing duration of each period from 10 years to 50 years). This supports the assumption that differences in sampling intensity would be higher in aggregated groups rather than individuals. Therefore, aggregating occurrences at larger  taxonomic and temporal scales show more difference in sampling intensity than at smaller scales.

Taxonomic groups (families) identified to have significant differences in sampling intensity are identified and ranked for the different regions based on the differences

Table: Differences in the Number of species identified between families
```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
s_differences = (species_differences_aus_glonaf |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "AUS GLONAF")) |>

dplyr::full_join(species_differences_gbr |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "GBR")) |>

dplyr::full_join(species_differences_irl |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "IRL")) |>

dplyr::full_join(species_differences_jpn |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "JPN")) |>

dplyr::full_join(species_differences_mdg |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "MDG")) |>

dplyr::full_join(species_differences_nzl_glonaf |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "NZL GLONAF")) |>

dplyr::full_join(species_differences_usa |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "USA")) |>

dplyr::full_join(species_differences_zaf |>
   dplyr::rename(group_1 = X1, group_2 = X2, lower_conf_limit = lwr, upper_conf_limit = upr, `p value` = `p adj`) |>
  dplyr::mutate(region = "ZAF")) |>
  
  dplyr::select(region, group_1, group_2, difference, lower_conf_limit, upper_conf_limit, `p value`) 


s_differences[ , c(4, 5, 6)] = s_differences[ , c(4, 5, 6)] |> round(2)
s_differences[ , 7] = s_differences[ , 7] |> round(4)

s_differences |>
  knitr::kable()

```

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
s_differences |> as.data.frame() |> group_by(region) |> summarise(min_difference = min(difference),
                                               mean_difference = mean(difference),
                                               max_difference = max(difference))

```



## (b) Temporal biases in Sampling Intensity

We observed a positive slope in the Number of records identified over time among some families across all the regions (figure 1). We estimate the slopes of the Number of records recorded for each family over time, and test the alternative hypothesis that there is a temporal change in sampling intensity (i.e slope > 0). 





```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(broom)
library(purrr)

# BY FAMILY

# aus_glonaf
sampling_intensity_slope_aus_glonaf = split.data.frame(assessSpeciesNumber_aus_glonaf, assessSpeciesNumber_aus_glonaf$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_aus_glonaf$Taxonomic_Group |> unique()), region = "aus_glonaf") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_aus_glonaf = sampling_intensity_slope_aus_glonaf[sampling_intensity_slope_aus_glonaf$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_aus_glonaf = sampling_intensity_slope_aus_glonaf[sampling_intensity_slope_aus_glonaf$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# gbr
sampling_intensity_slope_gbr = split.data.frame(assessSpeciesNumber_gbr, assessSpeciesNumber_gbr$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_gbr$Taxonomic_Group |> unique()), region = "gbr") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_gbr = sampling_intensity_slope_gbr[sampling_intensity_slope_gbr$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_gbr = sampling_intensity_slope_gbr[sampling_intensity_slope_gbr$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# irl
sampling_intensity_slope_irl = split.data.frame(assessSpeciesNumber_irl, assessSpeciesNumber_irl$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_irl$Taxonomic_Group |> unique()), region = "irl") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_irl = sampling_intensity_slope_irl[sampling_intensity_slope_irl$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_irl = sampling_intensity_slope_irl[sampling_intensity_slope_irl$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# jpn
sampling_intensity_slope_jpn = split.data.frame(assessSpeciesNumber_jpn, assessSpeciesNumber_jpn$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_jpn$Taxonomic_Group |> unique()), region = "jpn") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_jpn = sampling_intensity_slope_jpn[sampling_intensity_slope_jpn$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_jpn = sampling_intensity_slope_jpn[sampling_intensity_slope_jpn$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# mdg
sampling_intensity_slope_mdg = split.data.frame(assessSpeciesNumber_mdg, assessSpeciesNumber_mdg$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_mdg$Taxonomic_Group |> unique()), region = "mdg") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_mdg = sampling_intensity_slope_mdg[sampling_intensity_slope_mdg$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_mdg = sampling_intensity_slope_mdg[sampling_intensity_slope_mdg$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# nzl_glonaf
sampling_intensity_slope_nzl_glonaf = split.data.frame(assessSpeciesNumber_nzl_glonaf, assessSpeciesNumber_nzl_glonaf$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_nzl_glonaf$Taxonomic_Group |> unique()), region = "nzl_glonaf") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_nzl_glonaf = sampling_intensity_slope_nzl_glonaf[sampling_intensity_slope_nzl_glonaf$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_nzl_glonaf = sampling_intensity_slope_nzl_glonaf[sampling_intensity_slope_nzl_glonaf$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# usa
sampling_intensity_slope_usa = split.data.frame(assessSpeciesNumber_usa, assessSpeciesNumber_usa$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_usa$Taxonomic_Group |> unique()), region = "usa") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_usa = sampling_intensity_slope_usa[sampling_intensity_slope_usa$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_usa = sampling_intensity_slope_usa[sampling_intensity_slope_usa$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# zaf
sampling_intensity_slope_zaf = split.data.frame(assessSpeciesNumber_zaf, assessSpeciesNumber_zaf$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_zaf$Taxonomic_Group |> unique()), region = "zaf") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_zaf = sampling_intensity_slope_zaf[sampling_intensity_slope_zaf$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_zaf = sampling_intensity_slope_zaf[sampling_intensity_slope_zaf$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


dplyr::tibble(
  range = c("AUS GLONAF", "GBR", "IRL", "JPN", "MDG", "NZL GLONAF", "USA", "ZAF"),
  
  `number of families` = c(
    assessSpeciesNumber_aus_glonaf$Taxonomic_Group |> unique() |> length() ,
    assessSpeciesNumber_gbr$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_irl$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_jpn$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_mdg$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_nzl_glonaf$Taxonomic_Group |> unique() |> length() ,
    assessSpeciesNumber_usa$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_zaf$Taxonomic_Group |> unique() |> length()),
  
  `families with increasing sampling` = c(
    increasing_coverage_aus_glonaf, increasing_coverage_gbr, increasing_coverage_irl,
    increasing_coverage_jpn, increasing_coverage_mdg, increasing_coverage_nzl_glonaf,
    increasing_coverage_usa, increasing_coverage_zaf
  ),
  
  `families with decreasing sampling` = c(
    decreasing_coverage_aus_glonaf, decreasing_coverage_gbr, decreasing_coverage_irl,
    decreasing_coverage_jpn, decreasing_coverage_mdg, decreasing_coverage_nzl_glonaf,
    decreasing_coverage_usa, decreasing_coverage_zaf
  ),
  
  `% of families with increasing sampling` = round(100 * `families with increasing sampling` / `number of families`, 2),
  
  `% of families with decreasing sampling` =  round(100 * `families with decreasing sampling` / `number of families`, 2),
  
  `% of families without temporal changes` = 100 - (`% of families with increasing sampling` + `% of families with decreasing sampling`)) |>
  
  knitr::kable()
```


Temporal changes in sampling intensity were observed in between 16% (IRL) and 62.39% (GBR) of families across the  8 invaded regions. Increases in sampling intensities were more dominant than decreases among the families where temporal changes were observed.  



```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(broom)
# BY species

# aus_glonaf
sampling_intensity_slope_aus_glonaf_by_species = split.data.frame( assessSpeciesNumber_aus_glonaf_by_species |> dplyr::rename(Period = new_periods) ,  assessSpeciesNumber_aus_glonaf_by_species$Taxonomic_Group)   |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort( assessSpeciesNumber_aus_glonaf_by_species$Taxonomic_Group |> unique()), region = "aus_glonaf") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_aus_glonaf_by_species = sampling_intensity_slope_aus_glonaf_by_species[sampling_intensity_slope_aus_glonaf_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_aus_glonaf_by_species = sampling_intensity_slope_aus_glonaf_by_species[sampling_intensity_slope_aus_glonaf_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# gbr
sampling_intensity_slope_gbr_by_species = split.data.frame(assessSpeciesNumber_gbr_by_species |> dplyr::rename(Period = new_periods) , assessSpeciesNumber_gbr_by_species$Taxonomic_Group)   |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_gbr_by_species$Taxonomic_Group |> unique()), region = "gbr") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_gbr_by_species = sampling_intensity_slope_gbr_by_species[sampling_intensity_slope_gbr_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_gbr_by_species = sampling_intensity_slope_gbr_by_species[sampling_intensity_slope_gbr_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# irl
sampling_intensity_slope_irl_by_species = split.data.frame(assessSpeciesNumber_irl_by_species |> dplyr::rename(Period = new_periods) , assessSpeciesNumber_irl_by_species$Taxonomic_Group)   |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_irl_by_species$Taxonomic_Group |> unique()), region = "irl") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_irl_by_species = sampling_intensity_slope_irl_by_species[sampling_intensity_slope_irl_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_irl_by_species = sampling_intensity_slope_irl_by_species[sampling_intensity_slope_irl_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# jpn
sampling_intensity_slope_jpn_by_species = split.data.frame(assessSpeciesNumber_jpn_by_species |> dplyr::rename(Period = new_periods) , assessSpeciesNumber_jpn_by_species$Taxonomic_Group)   |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_jpn_by_species$Taxonomic_Group |> unique()), region = "jpn") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_jpn_by_species = sampling_intensity_slope_jpn_by_species[sampling_intensity_slope_jpn_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_jpn_by_species = sampling_intensity_slope_jpn_by_species[sampling_intensity_slope_jpn_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# mdg
sampling_intensity_slope_mdg_by_species = split.data.frame(assessSpeciesNumber_mdg_by_species |> dplyr::rename(Period = new_periods) , assessSpeciesNumber_mdg_by_species$Taxonomic_Group)   |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_mdg_by_species$Taxonomic_Group |> unique()), region = "mdg") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_mdg_by_species = sampling_intensity_slope_mdg_by_species[sampling_intensity_slope_mdg_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_mdg_by_species = sampling_intensity_slope_mdg_by_species[sampling_intensity_slope_mdg_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# nzl_glonaf
sampling_intensity_slope_nzl_glonaf_by_species = split.data.frame(assessSpeciesNumber_nzl_glonaf_by_species |> dplyr::rename(Period = new_periods) , assessSpeciesNumber_nzl_glonaf_by_species$Taxonomic_Group)   |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_nzl_glonaf_by_species$Taxonomic_Group |> unique()), region = "nzl_glonaf") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_nzl_glonaf_by_species = sampling_intensity_slope_nzl_glonaf_by_species[sampling_intensity_slope_nzl_glonaf_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_nzl_glonaf_by_species = sampling_intensity_slope_nzl_glonaf_by_species[sampling_intensity_slope_nzl_glonaf_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# usa
sampling_intensity_slope_usa_by_species = split.data.frame(assessSpeciesNumber_usa_by_species |> dplyr::rename(Period = new_periods) , assessSpeciesNumber_usa_by_species$Taxonomic_Group)    |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_usa_by_species$Taxonomic_Group |> unique()), region = "usa") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_usa_by_species = sampling_intensity_slope_usa_by_species[sampling_intensity_slope_usa_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_usa_by_species = sampling_intensity_slope_usa_by_species[sampling_intensity_slope_usa_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


# zaf
sampling_intensity_slope_zaf_by_species = split.data.frame(assessSpeciesNumber_zaf_by_species |> dplyr::rename(Period = new_periods) , assessSpeciesNumber_zaf_by_species$Taxonomic_Group)  |>
  purrr::map(~lm(val ~ 1 + Period, data = .x)) |>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpeciesNumber_zaf_by_species$Taxonomic_Group |> unique()), region = "zaf") |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::select(region, Taxonomic_group, estimate, std.error, statistic, p.value)


# number of groups with bias
increasing_coverage_zaf_by_species = sampling_intensity_slope_zaf_by_species[sampling_intensity_slope_zaf_by_species$estimate > 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()
decreasing_coverage_zaf_by_species = sampling_intensity_slope_zaf_by_species[sampling_intensity_slope_zaf_by_species$estimate < 0, "Taxonomic_group"]$Taxonomic_group |> unique() |> length()


dplyr::tibble(
  range = c("AUS GLONAF", "GBR", "IRL", "JPN", "MDG", "NZL GLONAF", "USA", "ZAF"),
  
  `Number of records` = c(
    assessSpeciesNumber_aus_glonaf_by_species$Taxonomic_Group |> unique() |> length() ,
    assessSpeciesNumber_gbr_by_species$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_irl_by_species$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_jpn_by_species$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_mdg_by_species$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_nzl_glonaf_by_species$Taxonomic_Group |> unique() |> length() ,
    assessSpeciesNumber_usa_by_species$Taxonomic_Group |> unique() |> length(),
    assessSpeciesNumber_zaf_by_species$Taxonomic_Group |> unique() |> length()),
  
  `species with increasing sampling` = c(
    increasing_coverage_aus_glonaf_by_species, increasing_coverage_gbr_by_species, increasing_coverage_irl_by_species,
    increasing_coverage_jpn_by_species, increasing_coverage_mdg_by_species, increasing_coverage_nzl_glonaf_by_species,
    increasing_coverage_usa_by_species, increasing_coverage_zaf_by_species
  ),
  
  `species with decreasing sampling` = c(
    decreasing_coverage_aus_glonaf_by_species, decreasing_coverage_gbr_by_species, decreasing_coverage_irl_by_species,
    decreasing_coverage_jpn_by_species, decreasing_coverage_mdg_by_species, decreasing_coverage_nzl_glonaf_by_species,
    decreasing_coverage_usa_by_species, decreasing_coverage_zaf_by_species
  ),
  
  `% of species with increasing sampling` = round(100 * `species with increasing sampling` / `Number of records`, 2),
  
  `% of species with decreasing sampling` =  round(100 * `species with decreasing sampling` / `Number of records`, 2),
  
  `% of species without temporal changes` = 100 - (`% of species with increasing sampling` + `% of species with decreasing sampling`)) |>
  
  knitr::kable()
```


In contrast, when occurrences are aggregated at species level, instances of temporal change in sampling intensity decrease to between 0% (IRL) and 18.86% (GBR). Here, decreases in sampling intensities were more dominant than increases  among the species  where temporal changes were observed.  
This suggests that aggregation at larger taxonomic scales makes temporal changes in sampling intensity more visible than at smaller scales. 





## (c) representation of rare species

We use the strength of the linear relationship between the number of observations recorded for a taxonomic group and the number of grid cells (range size) from which the observations were made to assess the level of sampling relative to the geographic range on the hypothesis that under random sampling, there should be a strong linear relationship between the number of observations made within taxonomic groups and the corresponding range sizes. 
The regression R-square statistic provides a goodness of fit measure for this relationship. A low R-square statistic implies range size explains only a small proportion of the recorded observations; indicating presence of over or under-sampling in some of the taxonomic groups. 



```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
# Rare Species Representation

file_link_aus_glonaf = here("13.  bias assessment results", "aus_glonaf_invaded_clean", directory_files_aus_glonaf[grepl("assessRarityBias_output", directory_files_aus_glonaf)])

file_link_aus_glonaf = file_link_aus_glonaf[!grepl("species", file_link_aus_glonaf)]
assessRarityBias_aus_glonaf = read.csv(file = file_link_aus_glonaf)
assessRarityBias_aus_glonaf = assessRarityBias_aus_glonaf |> 
  merge(periods_range_aus_glonaf, by.x = "period", by.y = "Period") |>
  dplyr::filter(!is.na(index)) |>
  dplyr::rename(Taxonomic_Group = id)


file_link_gbr = here("13.  bias assessment results", "gbr_invaded_clean", directory_files_gbr[grepl("assessRarityBias_output", directory_files_gbr)])

file_link_gbr = file_link_gbr[!grepl("species", file_link_gbr)]
assessRarityBias_gbr = read.csv(file = file_link_gbr)
assessRarityBias_gbr = assessRarityBias_gbr |> 
  merge(periods_range_gbr, by.x = "period", by.y = "Period") |>
  dplyr::filter(!is.na(index)) |>
  dplyr::rename(Taxonomic_Group = id)


file_link_irl = here("13.  bias assessment results", "irl_invaded_clean", directory_files_irl[grepl("assessRarityBias_output", directory_files_irl)])

file_link_irl = file_link_irl[!grepl("species", file_link_irl)]
assessRarityBias_irl = read.csv(file = file_link_irl)
assessRarityBias_irl = assessRarityBias_irl |> 
  merge(periods_range_irl, by.x = "period", by.y = "Period") |>
  dplyr::filter(!is.na(index)) |>
  dplyr::rename(Taxonomic_Group = id)


file_link_jpn = here("13.  bias assessment results", "jpn_invaded_clean", directory_files_jpn[grepl("assessRarityBias_output", directory_files_jpn)])

file_link_jpn = file_link_jpn[!grepl("species", file_link_jpn)]
assessRarityBias_jpn = read.csv(file = file_link_jpn)
assessRarityBias_jpn = assessRarityBias_jpn |> 
  merge(periods_range_jpn, by.x = "period", by.y = "Period") |>
  dplyr::filter(!is.na(index)) |>
  dplyr::rename(Taxonomic_Group = id)


file_link_mdg = here("13.  bias assessment results", "mdg_invaded_clean", directory_files_mdg[grepl("assessRarityBias_output", directory_files_mdg)])

file_link_mdg = file_link_mdg[!grepl("species", file_link_mdg)]
assessRarityBias_mdg = read.csv(file = file_link_mdg)
assessRarityBias_mdg = assessRarityBias_mdg |> 
  merge(periods_range_mdg, by.x = "period", by.y = "Period") |>
  dplyr::filter(!is.na(index)) |>
  dplyr::rename(Taxonomic_Group = id)


file_link_nzl_glonaf = here("13.  bias assessment results", "nzl_glonaf_invaded_clean", directory_files_nzl_glonaf[grepl("assessRarityBias_output", directory_files_nzl_glonaf)])

file_link_nzl_glonaf = file_link_nzl_glonaf[!grepl("species", file_link_nzl_glonaf)]
assessRarityBias_nzl_glonaf = read.csv(file = file_link_nzl_glonaf)
assessRarityBias_nzl_glonaf = assessRarityBias_nzl_glonaf |> 
  merge(periods_range_nzl_glonaf, by.x = "period", by.y = "Period") |>
  dplyr::filter(!is.na(index)) |>
  dplyr::rename(Taxonomic_Group = id)


file_link_usa = here("13.  bias assessment results", "usa_invaded_clean", directory_files_usa[grepl("assessRarityBias_output", directory_files_usa)])

file_link_usa = file_link_usa[!grepl("species", file_link_usa)]
assessRarityBias_usa = read.csv(file = file_link_usa)
assessRarityBias_usa = assessRarityBias_usa |> 
  merge(periods_range_usa, by.x = "period", by.y = "Period") |>
  dplyr::filter(!is.na(index)) |>
  dplyr::rename(Taxonomic_Group = id)


file_link_zaf = here("13.  bias assessment results", "zaf_invaded_clean", directory_files_zaf[grepl("assessRarityBias_output", directory_files_zaf)])

file_link_zaf = file_link_zaf[!grepl("species", file_link_zaf)]
assessRarityBias_zaf = read.csv(file = file_link_zaf)
assessRarityBias_zaf = assessRarityBias_zaf |> 
  merge(periods_range_zaf, by.x = "period", by.y = "Period") |>
  dplyr::filter(!is.na(index)) |>
  dplyr::rename(Taxonomic_Group = id)
```


Figure: Taxonomic bias index (Rare species representation)

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
rarity_plot_aus_glonaf = assessRarityBias_aus_glonaf |>
  ggplot(mapping = aes(x = period, y = index, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Taxonomic bias index", 
                    title = "Taxonomic coverage (Rare species representation)") +
  theme(legend.position = "none")


rarity_plot_gbr = assessRarityBias_gbr |>
  ggplot(mapping = aes(x = period, y = index, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Taxonomic bias index", 
                    title = "Taxonomic coverage (Rare species representation)") +
  theme(legend.position = "none")


rarity_plot_irl = assessRarityBias_irl |>
  ggplot(mapping = aes(x = period, y = index, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Taxonomic bias index", 
                    title = "Taxonomic coverage (Rare species representation)") +
  theme(legend.position = "none")


rarity_plot_jpn = assessRarityBias_jpn |>
  ggplot(mapping = aes(x = period, y = index, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Taxonomic bias index", 
                    title = "Taxonomic coverage (Rare species representation)") +
  theme(legend.position = "none")


rarity_plot_mdg = assessRarityBias_mdg |>
  ggplot(mapping = aes(x = period, y = index, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Taxonomic bias index", 
                    title = "Taxonomic coverage (Rare species representation)") +
  theme(legend.position = "none")


rarity_plot_nzl_glonaf = assessRarityBias_nzl_glonaf |>
  ggplot(mapping = aes(x = period, y = index, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Taxonomic bias index", 
                    title = "Taxonomic coverage (Rare species representation)") +
  theme(legend.position = "none")


rarity_plot_usa = assessRarityBias_usa |>
  ggplot(mapping = aes(x = period, y = index, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Taxonomic bias index", 
                    title = "Taxonomic coverage (Rare species representation)") +
  theme(legend.position = "none")


rarity_plot_zaf = assessRarityBias_zaf |>
  ggplot(mapping = aes(x = period, y = index, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Taxonomic bias index", 
                    title = "Taxonomic coverage (Rare species representation)") +
  theme(legend.position = "none")


grid.arrange(rarity_plot_aus_glonaf, rarity_plot_gbr, ncol = 2)
grid.arrange(rarity_plot_irl, rarity_plot_jpn, ncol = 2)
grid.arrange(rarity_plot_mdg, rarity_plot_nzl_glonaf, ncol = 2)
grid.arrange(rarity_plot_usa, rarity_plot_zaf, ncol = 2)
```


Table: Summary of the coverage index of rare species by taxonomic group
```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
rare_coverage_ranges_aus_glonaf = assessRarityBias_aus_glonaf |>
  dplyr::group_by(Taxonomic_Group)|>
  dplyr::summarise(n_periods = (period |> unique() |> length()),
                   from_period = (period |> unique() |> min()),
                   to_period = (period |> unique() |> max()),
                   mean_index = mean(index) |> round(2),
                   min_index = min(index) |> round(2),
                   max_index = max(index) |> round(2),
                   range_index = (max_index - min_index),
                   sd = sd(index) |> round(2)) |>
  dplyr::mutate(region = "aus_glonaf") |>
  dplyr::arrange(mean_index, from_period, to_period)


rare_coverage_ranges_gbr = assessRarityBias_gbr |>
  dplyr::group_by(Taxonomic_Group)|>
  dplyr::summarise(n_periods = (period |> unique() |> length()),
                   from_period = (period |> unique() |> min()),
                   to_period = (period |> unique() |> max()),
                   mean_index = mean(index) |> round(2),
                   min_index = min(index) |> round(2),
                   max_index = max(index) |> round(2),
                   range_index = (max_index - min_index),
                   sd = sd(index) |> round(2)) |>
  dplyr::mutate(region = "gbr") |>
  dplyr::arrange(mean_index, from_period, to_period)

rare_coverage_ranges_irl = assessRarityBias_irl |>
  dplyr::group_by(Taxonomic_Group)|>
  dplyr::summarise(n_periods = (period |> unique() |> length()),
                   from_period = (period |> unique() |> min()),
                   to_period = (period |> unique() |> max()),
                   mean_index = mean(index) |> round(2),
                   min_index = min(index) |> round(2),
                   max_index = max(index) |> round(2),
                   range_index = (max_index - min_index),
                   sd = sd(index) |> round(2)) |>
  dplyr::mutate(region = "irl") |>
  dplyr::arrange(mean_index, from_period, to_period)


rare_coverage_ranges_jpn = assessRarityBias_jpn |>
  dplyr::group_by(Taxonomic_Group)|>
  dplyr::summarise(n_periods = (period |> unique() |> length()),
                   from_period = (period |> unique() |> min()),
                   to_period = (period |> unique() |> max()),
                   mean_index = mean(index) |> round(2),
                   min_index = min(index) |> round(2),
                   max_index = max(index) |> round(2),
                   range_index = (max_index - min_index),
                   sd = sd(index) |> round(2)) |>
  dplyr::mutate(region = "jpn") |>
  dplyr::arrange(mean_index, from_period, to_period)


rare_coverage_ranges_mdg = assessRarityBias_mdg |>
  dplyr::group_by(Taxonomic_Group)|>
  dplyr::summarise(n_periods = (period |> unique() |> length()),
                   from_period = (period |> unique() |> min()),
                   to_period = (period |> unique() |> max()),
                   mean_index = mean(index) |> round(2),
                   min_index = min(index) |> round(2),
                   max_index = max(index) |> round(2),
                   range_index = (max_index - min_index),
                   sd = sd(index) |> round(2)) |>
  dplyr::mutate(region = "mdg") |>
  dplyr::arrange(mean_index, from_period, to_period)


rare_coverage_ranges_nzl_glonaf = assessRarityBias_nzl_glonaf |>
  dplyr::group_by(Taxonomic_Group)|>
  dplyr::summarise(n_periods = (period |> unique() |> length()),
                   from_period = (period |> unique() |> min()),
                   to_period = (period |> unique() |> max()),
                   mean_index = mean(index) |> round(2),
                   min_index = min(index) |> round(2),
                   max_index = max(index) |> round(2),
                   range_index = (max_index - min_index),
                   sd = sd(index) |> round(2)) |>
  dplyr::mutate(region = "nzl_glonaf") |>
  dplyr::arrange(mean_index, from_period, to_period)


rare_coverage_ranges_usa = assessRarityBias_usa |>
  dplyr::group_by(Taxonomic_Group)|>
  dplyr::summarise(n_periods = (period |> unique() |> length()),
                   from_period = (period |> unique() |> min()),
                   to_period = (period |> unique() |> max()),
                   mean_index = mean(index) |> round(2),
                   min_index = min(index) |> round(2),
                   max_index = max(index) |> round(2),
                   range_index = (max_index - min_index),
                   sd = sd(index) |> round(2)) |>
  dplyr::mutate(region = "usa") |>
  dplyr::arrange(mean_index, from_period, to_period)


rare_coverage_ranges_zaf = assessRarityBias_zaf |>
  dplyr::group_by(Taxonomic_Group)|>
  dplyr::summarise(n_periods = (period |> unique() |> length()),
                   from_period = (period |> unique() |> min()),
                   to_period = (period |> unique() |> max()),
                   mean_index = mean(index) |> round(2),
                   min_index = min(index) |> round(2),
                   max_index = max(index) |> round(2),
                   range_index = (max_index - min_index),
                   sd = sd(index) |> round(2)) |>
  dplyr::mutate(region = "zaf") |>
  dplyr::arrange(mean_index, from_period, to_period)


# join
rare_coverage_ranges_joined = rare_coverage_ranges_aus_glonaf |>
  dplyr::full_join(rare_coverage_ranges_gbr) |>
  dplyr::full_join(rare_coverage_ranges_irl) |>
  dplyr::full_join(rare_coverage_ranges_jpn) |>
  dplyr::full_join(rare_coverage_ranges_mdg) |>
  dplyr::full_join(rare_coverage_ranges_nzl_glonaf) |>
  dplyr::full_join(rare_coverage_ranges_usa) |>
  dplyr::full_join(rare_coverage_ranges_zaf) |> 
  dplyr::select(10, 1:9)


rare_coverage_ranges_joined |> 
  ggplot(aes(Taxonomic_Group, mean_index, color = region)) +
  geom_point() + theme_bw() +
  theme(axis.text.x=element_blank(), axis.ticks.x=element_blank(),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank()) +
  xlab("Taxonomic Groups") + ylab("Mean Rarity Index (R-square)")


# summary
rare_coverage_ranges_joined |>
  dplyr::group_by(region) |> 
  dplyr::summarise(Families = unique(Taxonomic_Group) |> length(),
                   average_periods = mean(n_periods) |> round(0),
                   `mean_tax_index_%` = round(100 * mean(mean_index), 2)) |>
  dplyr::arrange(dplyr::desc(`mean_tax_index_%`))  %T>% 
  print(knitr::kable) |>
  
  ggplot2::ggplot(aes(region, `mean_tax_index_%`)) + ggplot2::geom_col() +
  theme_bw() 


# full taxonomic indices table on rare species coverage
rare_coverage_ranges_joined |> knitr::kable()

# families with extreme indices for rare species coverage
rare_coverage_ranges_joined  |>  
  dplyr::filter(min_index < 0.05) |> 
  dplyr::group_by(region) |> 
  dplyr::summarise(`n_families with < 5% coverage index events` = length(Taxonomic_Group)) |>
  
  dplyr::full_join(rare_coverage_ranges_joined  |>  
                     dplyr::filter(max_index > 0.95) |> 
                     dplyr::group_by(region) |> 
                     dplyr::summarise(`n_families with > 95% coverage index events` = length(Taxonomic_Group))) |>
  
  dplyr::full_join(rare_coverage_ranges_joined |> 
                     dplyr::group_by(region) |> 
                     dplyr::summarise(`total n_families` = length(Taxonomic_Group))) |> 
  
  dplyr::full_join(rare_coverage_ranges_joined  |>  
                     dplyr::filter(max_index > 0.95 & min_index < 0.05) |> 
                     dplyr::group_by(region) |> 
                     dplyr::summarise(`n_families with > 95% & < 5% coverage index events` = length(Taxonomic_Group))) |>
  
  dplyr::mutate(`% families with  < 5% coverage index events` = round(100 * `n_families with < 5% coverage index events` / `total n_families`, 2),
                `% families with > 95% coverage index events` = round(100 * `n_families with > 95% coverage index events` / `total n_families`, 2),
                `% families with > 95% & < 5% coverage index events` = round(100 * `n_families with > 95% & < 5% coverage index events` / `total n_families`, 2)) |> 
  
  dplyr::select(-`n_families with < 5% coverage index events`, -`n_families with > 95% coverage index events`,
                -`n_families with > 95% & < 5% coverage index events`) |>
  knitr::kable()
```


Different families had different levels of taxonomic coverage. The number of periods in which observations within a family were made varied between `r rare_coverage_ranges_joined$n_periods |> min()` and `r rare_coverage_ranges_joined$n_periods |> max()` from one period to another across all the regions. Within a single 10-year period, the minimum observed coverage index for a single family was `r rare_coverage_ranges_joined$min_index |> min()` and the maximum `r rare_coverage_ranges_joined$max_index |> max()`.

This method however, does not differentiate between the over-sampling and under-sampling events in the occurrence records. To differentiate between over-sampling or under-sampling, Barends et al. (2020) (https://koedoe.co.za/index.php/koedoe/article/view/1579/2311) compared the residual values of each family to the range *mean  standard deviation* of all residual values. Families with residual number of records $> (mean\ +\ standard\ deviation)$ were over-sampled while families with residuals $< (mean\ -\ standard\ deviation)$ were under-sampled


```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}

# aus_glonaf
families_aus_glonaf = assessRarityBias_aus_glonaf$Taxonomic_Group |> unique()

family_residual_aus_glonaf = list()
for (family in families_aus_glonaf) {
  resid_fam_aus_glonaf = assessRarityBias_aus_glonaf |>
    dplyr::filter(Taxonomic_Group == family) |>
    dplyr::select(period, res) 
  
  range_all = c(quantile(assessRarityBias_aus_glonaf$res, 0.16),
                quantile(assessRarityBias_aus_glonaf$res, 0.84))
  
  family_residual_aus_glonaf[[family]] = data.frame(family = family,
                                             period = resid_fam_aus_glonaf$period,
                                             mean_residual = resid_fam_aus_glonaf$res |> round(2),
                                             conf_lower = rep(round(range_all[1], 2), length(resid_fam_aus_glonaf$period)),
                                             conf_upper = rep(round(range_all[2], 2), length(resid_fam_aus_glonaf$period)),
                                             undersampled = resid_fam_aus_glonaf$res < range_all[1],
                                             oversampled = resid_fam_aus_glonaf$res > range_all[2]) |>
    dplyr::filter(undersampled == TRUE | oversampled == TRUE)
  
  
}

family_residual_aus_glonaf = family_residual_aus_glonaf |> dplyr::bind_rows()
rownames(family_residual_aus_glonaf) = NULL

# number of over and undersampled groups
family_residual_aus_glonaf2 = family_residual_aus_glonaf |> 
  tidyr::pivot_longer(cols = c(undersampled, oversampled),
                      names_to = "Bias type", values_to = "status") |>
  dplyr::filter(status == TRUE) |> dplyr::select(-status) |>
  dplyr::group_by(family, period) |>
  dplyr::summarise(mean_residual = mean(mean_residual),
                   conf_lower = conf_lower, conf_upper = conf_upper) |>
  dplyr::ungroup(family, period) |>
  dplyr::mutate(`Bias type` = ifelse(mean_residual > conf_upper, "oversampled", "undersampled"))

family_residual_aus_glonaf2 = family_residual_aus_glonaf2[!duplicated(family_residual_aus_glonaf2),] |>
  dplyr::mutate(region = "aus_glonaf") |> dplyr::select(7, 1:6)

under_aus_glonaf = family_residual_aus_glonaf2 |>
  dplyr::filter(`Bias type` == "undersampled") 

over_aus_glonaf = family_residual_aus_glonaf2 |>
  dplyr::filter(`Bias type` == "oversampled") 



# gbr
families_gbr = assessRarityBias_gbr$Taxonomic_Group |> unique()

family_residual_gbr = list()
for (family in families_gbr) {
  resid_fam_gbr = assessRarityBias_gbr |>
    dplyr::filter(Taxonomic_Group == family) |>
    dplyr::select(period, res) 
  
  range_all = c(quantile(assessRarityBias_gbr$res, 0.16),
                quantile(assessRarityBias_gbr$res, 0.84))
  
  family_residual_gbr[[family]] = data.frame(family = family,
                                             period = resid_fam_gbr$period,
                                             mean_residual = resid_fam_gbr$res |> round(2),
                                             conf_lower = rep(round(range_all[1], 2), length(resid_fam_gbr$period)),
                                             conf_upper = rep(round(range_all[2], 2), length(resid_fam_gbr$period)),
                                             undersampled = resid_fam_gbr$res < range_all[1],
                                             oversampled = resid_fam_gbr$res > range_all[2]) |>
    dplyr::filter(undersampled == TRUE | oversampled == TRUE)
  
  
}

family_residual_gbr = family_residual_gbr |> dplyr::bind_rows()
rownames(family_residual_gbr) = NULL

# number of over and undersampled groups
family_residual_gbr2 = family_residual_gbr |> 
  tidyr::pivot_longer(cols = c(undersampled, oversampled),
                      names_to = "Bias type", values_to = "status") |>
  dplyr::filter(status == TRUE) |> dplyr::select(-status) |>
  dplyr::group_by(family, period) |>
  dplyr::summarise(mean_residual = mean(mean_residual),
                   conf_lower = conf_lower, conf_upper = conf_upper) |>
  dplyr::ungroup(family, period) |>
  dplyr::mutate(`Bias type` = ifelse(mean_residual > conf_upper, "oversampled", "undersampled"))

family_residual_gbr2 = family_residual_gbr2[!duplicated(family_residual_gbr2),] |>
  dplyr::mutate(region = "gbr") |> dplyr::select(7, 1:6)

under_gbr = family_residual_gbr2 |>
  dplyr::filter(`Bias type` == "undersampled") 

over_gbr = family_residual_gbr2 |>
  dplyr::filter(`Bias type` == "oversampled") 



# irl
families_irl = assessRarityBias_irl$Taxonomic_Group |> unique()

family_residual_irl = list()
for (family in families_irl) {
  resid_fam_irl = assessRarityBias_irl |>
    dplyr::filter(Taxonomic_Group == family) |>
    dplyr::select(period, res) 
  
  range_all = c(quantile(assessRarityBias_irl$res, 0.16),
                quantile(assessRarityBias_irl$res, 0.84))
  
  family_residual_irl[[family]] = data.frame(family = family,
                                             period = resid_fam_irl$period,
                                             mean_residual = resid_fam_irl$res |> round(2),
                                             conf_lower = rep(round(range_all[1], 2), length(resid_fam_irl$period)),
                                             conf_upper = rep(round(range_all[2], 2), length(resid_fam_irl$period)),
                                             undersampled = resid_fam_irl$res < range_all[1],
                                             oversampled = resid_fam_irl$res > range_all[2]) |>
    dplyr::filter(undersampled == TRUE | oversampled == TRUE)
  
  
}

family_residual_irl = family_residual_irl |> dplyr::bind_rows()
rownames(family_residual_irl) = NULL

# number of over and undersampled groups
family_residual_irl2 = family_residual_irl |> 
  tidyr::pivot_longer(cols = c(undersampled, oversampled),
                      names_to = "Bias type", values_to = "status") |>
  dplyr::filter(status == TRUE) |> dplyr::select(-status) |>
  dplyr::group_by(family, period) |>
  dplyr::summarise(mean_residual = mean(mean_residual),
                   conf_lower = conf_lower, conf_upper = conf_upper) |>
  dplyr::ungroup(family, period) |>
  dplyr::mutate(`Bias type` = ifelse(mean_residual > conf_upper, "oversampled", "undersampled"))

family_residual_irl2 = family_residual_irl2[!duplicated(family_residual_irl2),] |>
  dplyr::mutate(region = "irl") |> dplyr::select(7, 1:6)

under_irl = family_residual_irl2 |>
  dplyr::filter(`Bias type` == "undersampled") 

over_irl = family_residual_irl2 |>
  dplyr::filter(`Bias type` == "oversampled") 




# jpn
families_jpn = assessRarityBias_jpn$Taxonomic_Group |> unique()

family_residual_jpn = list()
for (family in families_jpn) {
  resid_fam_jpn = assessRarityBias_jpn |>
    dplyr::filter(Taxonomic_Group == family) |>
    dplyr::select(period, res) 
  
  range_all = c(quantile(assessRarityBias_jpn$res, 0.16),
                quantile(assessRarityBias_jpn$res, 0.84))
  
  family_residual_jpn[[family]] = data.frame(family = family,
                                             period = resid_fam_jpn$period,
                                             mean_residual = resid_fam_jpn$res |> round(2),
                                             conf_lower = rep(round(range_all[1], 2), length(resid_fam_jpn$period)),
                                             conf_upper = rep(round(range_all[2], 2), length(resid_fam_jpn$period)),
                                             undersampled = resid_fam_jpn$res < range_all[1],
                                             oversampled = resid_fam_jpn$res > range_all[2]) |>
    dplyr::filter(undersampled == TRUE | oversampled == TRUE)
  
  
}

family_residual_jpn = family_residual_jpn |> dplyr::bind_rows()
rownames(family_residual_jpn) = NULL

# number of over and undersampled groups
family_residual_jpn2 = family_residual_jpn |> 
  tidyr::pivot_longer(cols = c(undersampled, oversampled),
                      names_to = "Bias type", values_to = "status") |>
  dplyr::filter(status == TRUE) |> dplyr::select(-status) |>
  dplyr::group_by(family, period) |>
  dplyr::summarise(mean_residual = mean(mean_residual),
                   conf_lower = conf_lower, conf_upper = conf_upper) |>
  dplyr::ungroup(family, period) |>
  dplyr::mutate(`Bias type` = ifelse(mean_residual > conf_upper, "oversampled", "undersampled"))

family_residual_jpn2 = family_residual_jpn2[!duplicated(family_residual_jpn2),] |>
  dplyr::mutate(region = "jpn") |> dplyr::select(7, 1:6)

under_jpn = family_residual_jpn2 |>
  dplyr::filter(`Bias type` == "undersampled") 

over_jpn = family_residual_jpn2 |>
  dplyr::filter(`Bias type` == "oversampled") 




# mdg
families_mdg = assessRarityBias_mdg$Taxonomic_Group |> unique()

family_residual_mdg = list()
for (family in families_mdg) {
  resid_fam_mdg = assessRarityBias_mdg |>
    dplyr::filter(Taxonomic_Group == family) |>
    dplyr::select(period, res) 
  
  range_all = c(quantile(assessRarityBias_mdg$res, 0.16),
                quantile(assessRarityBias_mdg$res, 0.84))
  
  family_residual_mdg[[family]] = data.frame(family = family,
                                             period = resid_fam_mdg$period,
                                             mean_residual = resid_fam_mdg$res |> round(2),
                                             conf_lower = rep(round(range_all[1], 2), length(resid_fam_mdg$period)),
                                             conf_upper = rep(round(range_all[2], 2), length(resid_fam_mdg$period)),
                                             undersampled = resid_fam_mdg$res < range_all[1],
                                             oversampled = resid_fam_mdg$res > range_all[2]) |>
    dplyr::filter(undersampled == TRUE | oversampled == TRUE)
  
  
}

family_residual_mdg = family_residual_mdg |> dplyr::bind_rows()
rownames(family_residual_mdg) = NULL

# number of over and undersampled groups
family_residual_mdg2 = family_residual_mdg |> 
  tidyr::pivot_longer(cols = c(undersampled, oversampled),
                      names_to = "Bias type", values_to = "status") |>
  dplyr::filter(status == TRUE) |> dplyr::select(-status) |>
  dplyr::group_by(family, period) |>
  dplyr::summarise(mean_residual = mean(mean_residual),
                   conf_lower = conf_lower, conf_upper = conf_upper) |>
  dplyr::ungroup(family, period) |>
  dplyr::mutate(`Bias type` = ifelse(mean_residual > conf_upper, "oversampled", "undersampled"))

family_residual_mdg2 = family_residual_mdg2[!duplicated(family_residual_mdg2),] |>
  dplyr::mutate(region = "mdg") |> dplyr::select(7, 1:6)

under_mdg = family_residual_mdg2 |>
  dplyr::filter(`Bias type` == "undersampled") 

over_mdg = family_residual_mdg2 |>
  dplyr::filter(`Bias type` == "oversampled") 




# nzl_glonaf
families_nzl_glonaf = assessRarityBias_nzl_glonaf$Taxonomic_Group |> unique()

family_residual_nzl_glonaf = list()
for (family in families_nzl_glonaf) {
  resid_fam_nzl_glonaf = assessRarityBias_nzl_glonaf |>
    dplyr::filter(Taxonomic_Group == family) |>
    dplyr::select(period, res) 
  
  range_all = c(quantile(assessRarityBias_nzl_glonaf$res, 0.16),
                quantile(assessRarityBias_nzl_glonaf$res, 0.84))
  
  family_residual_nzl_glonaf[[family]] = data.frame(family = family,
                                             period = resid_fam_nzl_glonaf$period,
                                             mean_residual = resid_fam_nzl_glonaf$res |> round(2),
                                             conf_lower = rep(round(range_all[1], 2), length(resid_fam_nzl_glonaf$period)),
                                             conf_upper = rep(round(range_all[2], 2), length(resid_fam_nzl_glonaf$period)),
                                             undersampled = resid_fam_nzl_glonaf$res < range_all[1],
                                             oversampled = resid_fam_nzl_glonaf$res > range_all[2]) |>
    dplyr::filter(undersampled == TRUE | oversampled == TRUE)
  
  
}

family_residual_nzl_glonaf = family_residual_nzl_glonaf |> dplyr::bind_rows()
rownames(family_residual_nzl_glonaf) = NULL

# number of over and undersampled groups
family_residual_nzl_glonaf2 = family_residual_nzl_glonaf |> 
  tidyr::pivot_longer(cols = c(undersampled, oversampled),
                      names_to = "Bias type", values_to = "status") |>
  dplyr::filter(status == TRUE) |> dplyr::select(-status) |>
  dplyr::group_by(family, period) |>
  dplyr::summarise(mean_residual = mean(mean_residual),
                   conf_lower = conf_lower, conf_upper = conf_upper) |>
  dplyr::ungroup(family, period) |>
  dplyr::mutate(`Bias type` = ifelse(mean_residual > conf_upper, "oversampled", "undersampled"))

family_residual_nzl_glonaf2 = family_residual_nzl_glonaf2[!duplicated(family_residual_nzl_glonaf2),] |>
  dplyr::mutate(region = "nzl_glonaf") |> dplyr::select(7, 1:6)

under_nzl_glonaf = family_residual_nzl_glonaf2 |>
  dplyr::filter(`Bias type` == "undersampled") 

over_nzl_glonaf = family_residual_nzl_glonaf2 |>
  dplyr::filter(`Bias type` == "oversampled") 




# usa
families_usa = assessRarityBias_usa$Taxonomic_Group |> unique()

family_residual_usa = list()
for (family in families_usa) {
  resid_fam_usa = assessRarityBias_usa |>
    dplyr::filter(Taxonomic_Group == family) |>
    dplyr::select(period, res) 
  
  range_all = c(quantile(assessRarityBias_usa$res, 0.16),
                quantile(assessRarityBias_usa$res, 0.84))
  
  family_residual_usa[[family]] = data.frame(family = family,
                                             period = resid_fam_usa$period,
                                             mean_residual = resid_fam_usa$res |> round(2),
                                             conf_lower = rep(round(range_all[1], 2), length(resid_fam_usa$period)),
                                             conf_upper = rep(round(range_all[2], 2), length(resid_fam_usa$period)),
                                             undersampled = resid_fam_usa$res < range_all[1],
                                             oversampled = resid_fam_usa$res > range_all[2]) |>
    dplyr::filter(undersampled == TRUE | oversampled == TRUE)
  
  
}

family_residual_usa = family_residual_usa |> dplyr::bind_rows()
rownames(family_residual_usa) = NULL

# number of over and undersampled groups
family_residual_usa2 = family_residual_usa |> 
  tidyr::pivot_longer(cols = c(undersampled, oversampled),
                      names_to = "Bias type", values_to = "status") |>
  dplyr::filter(status == TRUE) |> dplyr::select(-status) |>
  dplyr::group_by(family, period) |>
  dplyr::summarise(mean_residual = mean(mean_residual),
                   conf_lower = conf_lower, conf_upper = conf_upper) |>
  dplyr::ungroup(family, period) |>
  dplyr::mutate(`Bias type` = ifelse(mean_residual > conf_upper, "oversampled", "undersampled"))

family_residual_usa2 = family_residual_usa2[!duplicated(family_residual_usa2),] |>
  dplyr::mutate(region = "usa") |> dplyr::select(7, 1:6)

under_usa = family_residual_usa2 |>
  dplyr::filter(`Bias type` == "undersampled") 

over_usa = family_residual_usa2 |>
  dplyr::filter(`Bias type` == "oversampled") 




# zaf
families_zaf = assessRarityBias_zaf$Taxonomic_Group |> unique()

family_residual_zaf = list()
for (family in families_zaf) {
  resid_fam_zaf = assessRarityBias_zaf |>
    dplyr::filter(Taxonomic_Group == family) |>
    dplyr::select(period, res) 
  
  range_all = c(quantile(assessRarityBias_zaf$res, 0.16),
                quantile(assessRarityBias_zaf$res, 0.84))
  
  family_residual_zaf[[family]] = data.frame(family = family,
                                             period = resid_fam_zaf$period,
                                             mean_residual = resid_fam_zaf$res |> round(2),
                                             conf_lower = rep(round(range_all[1], 2), length(resid_fam_zaf$period)),
                                             conf_upper = rep(round(range_all[2], 2), length(resid_fam_zaf$period)),
                                             undersampled = resid_fam_zaf$res < range_all[1],
                                             oversampled = resid_fam_zaf$res > range_all[2]) |>
    dplyr::filter(undersampled == TRUE | oversampled == TRUE)
  
  
}

family_residual_zaf = family_residual_zaf |> dplyr::bind_rows()
rownames(family_residual_zaf) = NULL

# number of over and undersampled groups
family_residual_zaf2 = family_residual_zaf |> 
  tidyr::pivot_longer(cols = c(undersampled, oversampled),
                      names_to = "Bias type", values_to = "status") |>
  dplyr::filter(status == TRUE) |> dplyr::select(-status) |>
  dplyr::group_by(family, period) |>
  dplyr::summarise(mean_residual = mean(mean_residual),
                   conf_lower = conf_lower, conf_upper = conf_upper) |>
  dplyr::ungroup(family, period) |>
  dplyr::mutate(`Bias type` = ifelse(mean_residual > conf_upper, "oversampled", "undersampled"))

family_residual_zaf2 = family_residual_zaf2[!duplicated(family_residual_zaf2),] |>
  dplyr::mutate(region = "zaf") |> dplyr::select(7, 1:6)

under_zaf = family_residual_zaf2 |>
  dplyr::filter(`Bias type` == "undersampled") 

over_zaf = family_residual_zaf2 |>
  dplyr::filter(`Bias type` == "oversampled") 

library(dplyr)
family_residual_joined = family_residual_aus_glonaf2 |>
  full_join(family_residual_gbr2) |>
  full_join(family_residual_irl2) |>
  full_join(family_residual_jpn2) |>
  full_join(family_residual_mdg2) |>
  full_join(family_residual_nzl_glonaf2) |>
  full_join(family_residual_usa2) |>
  full_join(family_residual_zaf2)

# summary
family_residual_joined |> 
  group_by(region, `Bias type`) |>
  summarise(n_biased_families = length(unique(family)), n_bias_events = length(period)) |> 
  knitr::kable()



(family_residual_joined |> 
  group_by(region, family, `Bias type`) |>
  summarise(periods = length(period))) |> 
  group_by(`Bias type`) |> 
  summarise(min_periods = min(periods), max_periods = max(periods))


bias_type_ttest = t.test(periods ~ `Bias type`, data = (family_residual_joined |> 
  group_by(region, family, `Bias type`) |>
  summarise(periods = length(period)))) 

bias_type_ttest_pvalue = bias_type_ttest$p.value
```


We observed oversampling in fewer families than we did undersampling. Similarly, there were generally fewer instances of oversampling than there were instances of undersampling across all the regions. The number of periods where oversampling was observed varied between 1 to 11 periods for different familes while undersampling was observed in between 1 to 14 periods. The p.value from the t-test comparing the mean number of periods (events) between oversampling and undersampling (p.value: `r bias_type_ttest_pvalue` < 0.05) confirms the alternative hypothesis that the average number of undersampling events (`r bias_type_ttest$estimate[2] |> round(0)`) is greater than the average number of undersampling events (`r bias_type_ttest$estimate[1] |> round(0)`).


## Temporal changes in Taxonomic Coverage Index

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(broom)
library(purrr)
library(dplyr)
library(ggplot2)

# aus_glonaf

rare_coverage_slope_aus_glonaf =  split.data.frame(assessRarityBias_aus_glonaf, assessRarityBias_aus_glonaf$Taxonomic_Group)|>
  purrr::map(~lm(index ~ 1 + period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'period') |>
  dplyr::mutate(term = sort(assessRarityBias_aus_glonaf$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate))

# gbr

rare_coverage_slope_gbr =  split.data.frame(assessRarityBias_gbr, assessRarityBias_gbr$Taxonomic_Group)|>
  purrr::map(~lm(index ~ 1 + period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'period') |>
  dplyr::mutate(term = sort(assessRarityBias_gbr$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate))

# irl

rare_coverage_slope_irl =  split.data.frame(assessRarityBias_irl, assessRarityBias_irl$Taxonomic_Group)|>
  purrr::map(~lm(index ~ 1 + period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'period') |>
  dplyr::mutate(term = sort(assessRarityBias_irl$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate))

# jpn

rare_coverage_slope_jpn =  split.data.frame(assessRarityBias_jpn, assessRarityBias_jpn$Taxonomic_Group)|>
  purrr::map(~lm(index ~ 1 + period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'period') |>
  dplyr::mutate(term = sort(assessRarityBias_jpn$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate))

# mdg

rare_coverage_slope_mdg =  split.data.frame(assessRarityBias_mdg, assessRarityBias_mdg$Taxonomic_Group)|>
  purrr::map(~lm(index ~ 1 + period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'period') |>
  dplyr::mutate(term = sort(assessRarityBias_mdg$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate))


# nzl_glonaf

rare_coverage_slope_nzl_glonaf =  split.data.frame(assessRarityBias_nzl_glonaf, assessRarityBias_nzl_glonaf$Taxonomic_Group)|>
  purrr::map(~lm(index ~ 1 + period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'period') |>
  dplyr::mutate(term = sort(assessRarityBias_nzl_glonaf$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate))


# usa

rare_coverage_slope_usa =  split.data.frame(assessRarityBias_usa, assessRarityBias_usa$Taxonomic_Group)|>
  purrr::map(~lm(index ~ 1 + period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'period') |>
  dplyr::mutate(term = sort(assessRarityBias_usa$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate))

# zaf

rare_coverage_slope_zaf =  split.data.frame(assessRarityBias_zaf, assessRarityBias_zaf$Taxonomic_Group)|>
  purrr::map(~lm(index ~ 1 + period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'period') |>
  dplyr::mutate(term = sort(assessRarityBias_zaf$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate))



rare_coverage_slope_joined = rare_coverage_slope_aus_glonaf |>
  mutate(region = "aus_glonaf") |>
  
  full_join(
    rare_coverage_slope_gbr |>
      mutate(region = "gbr")) |>
  
  full_join(
    rare_coverage_slope_irl |>
      mutate(region = "irl")) |>
  
  full_join(
    rare_coverage_slope_jpn |>
      mutate(region = "jpn")) |>
  
  full_join(
    rare_coverage_slope_mdg |>
      mutate(region = "mdg")) |>
  
  full_join(
    rare_coverage_slope_nzl_glonaf |>
      mutate(region = "nzl_glonaf")) |>
  
  full_join(
    rare_coverage_slope_usa |>
      mutate(region = "usa")) |>
  
  full_join(
    rare_coverage_slope_zaf |>
      mutate(region = "zaf")) |> 
  select(6, 1:5)


rare_coverage_slope_joined |>
  group_by(region) |> 
  summarise(families_with_increasing_index = length(which(estimate > 0)), 
            families_with_decreasing_index = length(which(estimate < 0)),
            min_slope = min(estimate),
            max_slope = max(estimate)) |> knitr::kable()
```


The congruence between the number of observations recorded and the range (number of cells) from which the observations were made increased over time in between 41.67% and 78.18% of the families across the 8 regions. This implies a decrease in the rare species coverage bias. From the slope estimates of the rare species coverage index over time, increasing the sampling range by 10 cells increased the number of observations by an average of 8.0 records in the family with the highest rate of increase coverage index (GBR) and by an average of 1.4 records in the family with the least rate of increase (JPN). 
In contrast, there were fewer families (between 0% and 28.13%) where a decrease in the rare species coverage index was observed over time, implying an increase in the level of rare species coverage bias. An increase in the range by 10 cells corresponded to an average decrease in the number of observations by 9.6 records in (JPN) the region with the highest rate of decrease and 0.4 records (NZL_GLONAF) where the rate of decrease was least. IRL was the only region where no family recorded a decrease in the rare species coverage index.



# 2. Spatial biases

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
## aus_glonaf
directory_files_aus_glonaf = list.files(here("13.  bias assessment results", "aus_glonaf_invaded_clean"))

file_link_aus_glonaf = here("13.  bias assessment results", "aus_glonaf_invaded_clean", directory_files_aus_glonaf[grepl("assessSpatialBias_output", directory_files_aus_glonaf)])

file_link_aus_glonaf = file_link_aus_glonaf[!grepl("species", file_link_aus_glonaf)]
assessSpatialBias_aus_glonaf = read.csv(file = file_link_aus_glonaf)
assessSpatialBias_aus_glonaf = assessSpatialBias_aus_glonaf |> 
  merge(periods_range_aus_glonaf, by.x = "Period", by.y = "Period") |>
  dplyr::filter(!is.na(mean)) |>
  dplyr::rename(Taxonomic_Group = identifier)

### Figure: Nearest neighbour index for aus_glonaf_invaded_clean occurrence data

assessSpatialBias_aus_glonaf_plot = assessSpatialBias_aus_glonaf |>
  ggplot(mapping = aes(x = Period, y = mean, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Nearest neighbour index", 
                    title = "Randomness of the Occurrence records grouped by family") +
  theme(legend.position = "none")


## gbr
directory_files_gbr = list.files(here("13.  bias assessment results", "gbr_invaded_clean"))

file_link_gbr = here("13.  bias assessment results", "gbr_invaded_clean", directory_files_gbr[grepl("assessSpatialBias_output", directory_files_gbr)])

file_link_gbr = file_link_gbr[!grepl("species", file_link_gbr)]
assessSpatialBias_gbr = read.csv(file = file_link_gbr)
assessSpatialBias_gbr = assessSpatialBias_gbr |> 
  merge(periods_range_gbr, by.x = "Period", by.y = "Period") |>
  dplyr::filter(!is.na(mean)) |>
  dplyr::rename(Taxonomic_Group = identifier)

### Figure: Nearest neighbour index for gbr_invaded_clean occurrence data

assessSpatialBias_gbr_plot = assessSpatialBias_gbr |>
  ggplot(mapping = aes(x = Period, y = mean, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Nearest neighbour index", 
                    title = "Randomness of the Occurrence records grouped by family") +
  theme(legend.position = "none")


## irl
directory_files_irl = list.files(here("13.  bias assessment results", "irl_invaded_clean"))

file_link_irl = here("13.  bias assessment results", "irl_invaded_clean", directory_files_irl[grepl("assessSpatialBias_output", directory_files_irl)])

file_link_irl = file_link_irl[!grepl("species", file_link_irl)]
assessSpatialBias_irl = read.csv(file = file_link_irl)
assessSpatialBias_irl = assessSpatialBias_irl |> 
  merge(periods_range_irl, by.x = "Period", by.y = "Period") |>
  dplyr::filter(!is.na(mean)) |>
  dplyr::rename(Taxonomic_Group = identifier)

### Figure: Nearest neighbour index for irl_invaded_clean occurrence data

assessSpatialBias_irl_plot = assessSpatialBias_irl |>
  ggplot(mapping = aes(x = Period, y = mean, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Nearest neighbour index", 
                    title = "Randomness of the Occurrence records grouped by family") +
  theme(legend.position = "none")



## jpn
directory_files_jpn = list.files(here("13.  bias assessment results", "jpn_invaded_clean"))

file_link_jpn = here("13.  bias assessment results", "jpn_invaded_clean", directory_files_jpn[grepl("assessSpatialBias_output", directory_files_jpn)])

file_link_jpn = file_link_jpn[!grepl("species", file_link_jpn)]
assessSpatialBias_jpn = read.csv(file = file_link_jpn)
assessSpatialBias_jpn = assessSpatialBias_jpn |> 
  merge(periods_range_jpn, by.x = "Period", by.y = "Period") |>
  dplyr::filter(!is.na(mean)) |>
  dplyr::rename(Taxonomic_Group = identifier)

### Figure: Nearest neighbour index for jpn_invaded_clean occurrence data

assessSpatialBias_jpn_plot = assessSpatialBias_jpn |>
  ggplot(mapping = aes(x = Period, y = mean, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Nearest neighbour index", 
                    title = "Randomness of the Occurrence records grouped by family") +
  theme(legend.position = "none")


## mdg
directory_files_mdg = list.files(here("13.  bias assessment results", "mdg_invaded_clean"))

file_link_mdg = here("13.  bias assessment results", "mdg_invaded_clean", directory_files_mdg[grepl("assessSpatialBias_output", directory_files_mdg)])

file_link_mdg = file_link_mdg[!grepl("species", file_link_mdg)]
assessSpatialBias_mdg = read.csv(file = file_link_mdg)
assessSpatialBias_mdg = assessSpatialBias_mdg |> 
  merge(periods_range_mdg, by.x = "Period", by.y = "Period") |>
  dplyr::filter(!is.na(mean)) |>
  dplyr::rename(Taxonomic_Group = identifier)

### Figure: Nearest neighbour index for mdg_invaded_clean occurrence data

assessSpatialBias_mdg_plot = assessSpatialBias_mdg |>
  ggplot(mapping = aes(x = Period, y = mean, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Nearest neighbour index", 
                    title = "Randomness of the Occurrence records grouped by family") +
  theme(legend.position = "none")



## nzl_glonaf
directory_files_nzl_glonaf = list.files(here("13.  bias assessment results", "nzl_glonaf_invaded_clean"))

file_link_nzl_glonaf = here("13.  bias assessment results", "nzl_glonaf_invaded_clean", directory_files_nzl_glonaf[grepl("assessSpatialBias_output", directory_files_nzl_glonaf)])

file_link_nzl_glonaf = file_link_nzl_glonaf[!grepl("species", file_link_nzl_glonaf)]
assessSpatialBias_nzl_glonaf = read.csv(file = file_link_nzl_glonaf)
assessSpatialBias_nzl_glonaf = assessSpatialBias_nzl_glonaf |> 
  merge(periods_range_nzl_glonaf, by.x = "Period", by.y = "Period") |>
  dplyr::filter(!is.na(mean)) |>
  dplyr::rename(Taxonomic_Group = identifier)

### Figure: Nearest neighbour index for nzl_glonaf_invaded_clean occurrence data

assessSpatialBias_nzl_glonaf_plot = assessSpatialBias_nzl_glonaf |>
  ggplot(mapping = aes(x = Period, y = mean, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Nearest neighbour index", 
                    title = "Randomness of the Occurrence records grouped by family") +
  theme(legend.position = "none")


## usa
directory_files_usa = list.files(here("13.  bias assessment results", "usa_invaded_clean"))

file_link_usa = here("13.  bias assessment results", "usa_invaded_clean", directory_files_usa[grepl("assessSpatialBias_output", directory_files_usa)])

file_link_usa = file_link_usa[!grepl("species", file_link_usa)]
assessSpatialBias_usa = read.csv(file = file_link_usa)
assessSpatialBias_usa = assessSpatialBias_usa |> 
  merge(periods_range_usa, by.x = "Period", by.y = "Period") |>
  dplyr::filter(!is.na(mean)) |>
  dplyr::rename(Taxonomic_Group = identifier)

### Figure: Nearest neighbour index for usa_invaded_clean occurrence data

assessSpatialBias_usa_plot = assessSpatialBias_usa |>
  ggplot(mapping = aes(x = Period, y = mean, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Nearest neighbour index", 
                    title = "Randomness of the Occurrence records grouped by family") +
  theme(legend.position = "none")



## zaf
directory_files_zaf = list.files(here("13.  bias assessment results", "zaf_invaded_clean"))

file_link_zaf = here("13.  bias assessment results", "zaf_invaded_clean", directory_files_zaf[grepl("assessSpatialBias_output", directory_files_zaf)])

file_link_zaf = file_link_zaf[!grepl("species", file_link_zaf)]
assessSpatialBias_zaf = read.csv(file = file_link_zaf)
assessSpatialBias_zaf = assessSpatialBias_zaf |> 
  merge(periods_range_zaf, by.x = "Period", by.y = "Period") |>
  dplyr::filter(!is.na(mean)) |>
  dplyr::rename(Taxonomic_Group = identifier)

### Figure: Nearest neighbour index for zaf_invaded_clean occurrence data

assessSpatialBias_zaf_plot = assessSpatialBias_zaf |>
  ggplot(mapping = aes(x = Period, y = mean, color = Taxonomic_Group)) +
  geom_point( ) + geom_line() + 
  theme_bw() + labs(y = "Nearest neighbour index", 
                    title = "Randomness of the Occurrence records grouped by family") +
  theme(legend.position = "none")


NN_index_summary = dplyr::tibble(
  
  region = c(
    "aus_glonaf", "gbr", "irl", "jpn", "mdg", "nzl_glonaf", "usa", "zaf"),
  
  `unique periods` = c(
    assessSpatialBias_aus_glonaf$Period |> unique() |> length(),
    assessSpatialBias_gbr$Period |> unique() |> length(),
    assessSpatialBias_irl$Period |> unique() |> length(),
    assessSpatialBias_jpn$Period |> unique() |> length(),
    assessSpatialBias_mdg$Period |> unique() |> length(),
    assessSpatialBias_nzl_glonaf$Period |> unique() |> length(),
    assessSpatialBias_usa$Period |> unique() |> length(),
    assessSpatialBias_zaf$Period |> unique() |> length()
  ),
  
  `unique families` = c(
    assessSpatialBias_aus_glonaf$Taxonomic_Group |> unique() |> length(),
    assessSpatialBias_gbr$Taxonomic_Group |> unique() |> length(),
    assessSpatialBias_irl$Taxonomic_Group |> unique() |> length(),
    assessSpatialBias_jpn$Taxonomic_Group |> unique() |> length(),
    assessSpatialBias_mdg$Taxonomic_Group |> unique() |> length(),
    assessSpatialBias_nzl_glonaf$Taxonomic_Group |> unique() |> length(),
    assessSpatialBias_usa$Taxonomic_Group |> unique() |> length(),
    assessSpatialBias_zaf$Taxonomic_Group |> unique() |> length()
  ),
  
  `events with index < 1` = c(
    assessSpatialBias_aus_glonaf |> filter(mean  < 1) |> nrow(),
    assessSpatialBias_gbr |> filter(mean  < 1) |> nrow(),
    assessSpatialBias_irl |> filter(mean  < 1) |> nrow(),
    assessSpatialBias_jpn |> filter(mean  < 1) |> nrow(),
    assessSpatialBias_mdg |> filter(mean  < 1) |> nrow(),
    assessSpatialBias_nzl_glonaf |> filter(mean  < 1) |> nrow(),
    assessSpatialBias_usa |> filter(mean  < 1) |> nrow(),
    assessSpatialBias_zaf |> filter(mean  < 1) |> nrow()),
  
  `events with index > 1` = c(
    assessSpatialBias_aus_glonaf |> filter(mean  > 1) |> nrow(),
    assessSpatialBias_gbr |> filter(mean  > 1) |> nrow(),
    assessSpatialBias_irl |> filter(mean  > 1) |> nrow(),
    assessSpatialBias_jpn |> filter(mean  > 1) |> nrow(),
    assessSpatialBias_mdg |> filter(mean  > 1) |> nrow(),
    assessSpatialBias_nzl_glonaf |> filter(mean  > 1) |> nrow(),
    assessSpatialBias_usa |> filter(mean  > 1) |> nrow(),
    assessSpatialBias_zaf |> filter(mean  > 1) |> nrow()),
  
  `min index` = c(
    assessSpatialBias_aus_glonaf$mean |> min(),
    assessSpatialBias_gbr$mean |> min(),
    assessSpatialBias_irl$mean |> min(),
    assessSpatialBias_jpn$mean |> min(),
    assessSpatialBias_mdg$mean |> min(),
    assessSpatialBias_nzl_glonaf$mean |> min(),
    assessSpatialBias_usa$mean |> min(),
    assessSpatialBias_zaf$mean |> min()),
  
  
  `max index` = c(
    assessSpatialBias_aus_glonaf$mean |> max(),
    assessSpatialBias_gbr$mean |> max(),
    assessSpatialBias_irl$mean |> max(),
    assessSpatialBias_jpn$mean |> max(),
    assessSpatialBias_mdg$mean |> max(),
    assessSpatialBias_nzl_glonaf$mean |> max(),
    assessSpatialBias_usa$mean |> max(),
    assessSpatialBias_zaf$mean |> max()))


NN_index_summary |> knitr::kable()
```


The Nearest neighbor index was  < 1 for all taxonomic groups across most of the periods. in all the 8 ranges. This implies that observations were more clustered than the random distribution signaling a bias towards certain sampling locations (oversampling). 
There were only a few instances where certain families had  Nearest neighbor indices > 1, i.e sampling locations were sparsely distributed relative to a normal distribution (undersampling). 

NOTE: There are more instances of undersampling than oversampling among taxonomic groups. However, there are more instances of spatial (geographic) oversampling than undersampling.

## temporal changes in randomness of sampling distribution in the geographic space

```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
library(broom)
library(purrr)


# aus_glonaf
spatial_index_slope_aus_glonaf = split.data.frame(assessSpatialBias_aus_glonaf, assessSpatialBias_aus_glonaf$Taxonomic_Group) |>
  purrr::map(~lm(mean ~ 1 + Period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpatialBias_aus_glonaf$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::mutate(region = "aus_glonaf")




# gbr
spatial_index_slope_gbr = split.data.frame(assessSpatialBias_gbr, assessSpatialBias_gbr$Taxonomic_Group) |>
  purrr::map(~lm(mean ~ 1 + Period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpatialBias_gbr$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::mutate(region = "gbr")



# irl
spatial_index_slope_irl = split.data.frame(assessSpatialBias_irl, assessSpatialBias_irl$Taxonomic_Group) |>
  purrr::map(~lm(mean ~ 1 + Period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpatialBias_irl$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::mutate(region = "irl")



# jpn
spatial_index_slope_jpn = split.data.frame(assessSpatialBias_jpn, assessSpatialBias_jpn$Taxonomic_Group) |>
  purrr::map(~lm(mean ~ 1 + Period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpatialBias_jpn$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::mutate(region = "jpn")



# mdg
spatial_index_slope_mdg = split.data.frame(assessSpatialBias_mdg, assessSpatialBias_mdg$Taxonomic_Group) |>
  purrr::map(~lm(mean ~ 1 + Period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpatialBias_mdg$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::mutate(region = "mdg")



# nzl_glonaf
spatial_index_slope_nzl_glonaf = split.data.frame(assessSpatialBias_nzl_glonaf, assessSpatialBias_nzl_glonaf$Taxonomic_Group) |>
  purrr::map(~lm(mean ~ 1 + Period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpatialBias_nzl_glonaf$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::mutate(region = "nzl_glonaf")



# usa
spatial_index_slope_usa = split.data.frame(assessSpatialBias_usa, assessSpatialBias_usa$Taxonomic_Group) |>
  purrr::map(~lm(mean ~ 1 + Period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpatialBias_usa$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::mutate(region = "usa")



# zaf
spatial_index_slope_zaf = split.data.frame(assessSpatialBias_zaf, assessSpatialBias_zaf$Taxonomic_Group) |>
  purrr::map(~lm(mean ~ 1 + Period, data = .x))|>
  purrr::map_df(tidy) |>
  dplyr::filter(term == 'Period') |>
  dplyr::mutate(term = sort(assessSpatialBias_zaf$Taxonomic_Group |> unique())) |>
  dplyr::filter(p.value < 0.05 | p.value == 0.05) |>
  dplyr::rename(Taxonomic_group = term) |> dplyr::arrange(desc(estimate)) |>
  dplyr::mutate(region = "zaf")


spatial_index_slope_joined = spatial_index_slope_aus_glonaf |>
  full_join(spatial_index_slope_gbr) |>
  full_join(spatial_index_slope_irl) |> 
  full_join(spatial_index_slope_jpn) |>
  full_join(spatial_index_slope_mdg) |>
  full_join(spatial_index_slope_nzl_glonaf) |>
  full_join(spatial_index_slope_usa) |>
  full_join(spatial_index_slope_zaf)


spatial_index_slope_joined |> 
  group_by(region) |> 
  summarise(families_with_increasing_index = length(which(estimate > 0)),
            families_with_decreasing_index = length(which(estimate < 0)),
            min_slope = min(estimate),
            max_slope = max(estimate)) |> 
  knitr::kable()


```







```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}


```





```{r, echo =FALSE, cache=TRUE, results='asis', message=FALSE, warning=FALSE}
```





